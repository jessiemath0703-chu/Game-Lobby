<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jessie Math - æ·æè€å¸« éŠæˆ²å¤§å»³</title> 
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-yellow: #FFD700;
            --text-dark: #2c3e50;
            --text-gray: #636e72;
            --bg-light: #FDFBF7;
            --card-shadow: 0 8px 20px rgba(0,0,0,0.06);
            --radius-main: 24px;
            --dark-blue: #2C3E50;
            --btn-blue: #0984e3; 
            --btn-blue-hover: #74b9ff;

            --modal-game-bg: #00b894;
            --modal-video-bg: #ff7675;
            --modal-doc-bg: #fdcb6e;

            --modal-topicgame-bg: #6c5ce7;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg-light); color: var(--text-dark); line-height: 1.6; font-weight: 500; scroll-behavior: smooth; }
        a { text-decoration: none; color: inherit; }
        button { font-family: 'Noto Sans TC', sans-serif; }

        header { background: white; padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.03); position: sticky; top: 0; z-index: 1000; }
        .header-left { display: flex; align-items: center; gap: 15px; }
        .logo-circle { width: 55px; height: 55px; border-radius: 50%; overflow: hidden; border: 3px solid #eee; }
        .logo-circle img { width: 100%; height: 100%; object-fit: cover; }
        .header-title-group { display: flex; flex-direction: column; }
        .main-title { font-size: 1.6rem; font-weight: 900; color: var(--text-dark); line-height: 1.2; letter-spacing: -0.5px; }
        .sub-title { font-size: 0.9rem; color: var(--text-gray); letter-spacing: 1px; font-weight: 700; }
        .header-nav { display: flex; gap: 20px; align-items: center; }
        .nav-btn { padding: 10px 25px; border-radius: 30px; font-weight: 700; font-size: 1rem; transition: all 0.3s ease; cursor: pointer; }
        .nav-btn.active { background-color: var(--primary-yellow); color: var(--text-dark); box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4); }
        .nav-btn.text-only { background: transparent; color: var(--text-dark); }
        .nav-btn.youtube { color: #d63031; }
        .nav-btn:hover { transform: translateY(-2px); }

        .intro-section { max-width: 1100px; margin: 60px auto; padding: 0 20px; text-align: center; }
        .intro-headline { font-size: 2.6rem; font-weight: 900; color: var(--text-dark); margin-bottom: 20px; line-height: 1.4; }
        .highlight-bg { background: linear-gradient(180deg, transparent 65%, var(--primary-yellow) 65%); display: inline-block; padding: 0 10px; color: var(--text-dark); }
        .intro-subtext { color: #636e72; font-size: 1.2rem; margin-bottom: 50px; max-width: 800px; margin: 0 auto 50px; font-weight: 500; }
        
        .intro-grid { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 30px; text-align: left; }

        .guide-card { background: white; border: 2px solid #fff; border-radius: var(--radius-main); padding: 45px; box-shadow: var(--card-shadow); display: flex; flex-direction: column; justify-content: center; }
        .guide-title { color: #0984e3; font-size: 1.8rem; font-weight: 900; margin-bottom: 25px; display: flex; align-items: center; gap: 12px; }
        .guide-content p { margin-bottom: 25px; font-size: 1.35rem; color: #2d3436; line-height: 1.8; font-weight: 500; }
        .highlight-text { background-color: #E3F2FD; color: #0984e3; padding: 4px 10px; border-radius: 6px; font-weight: 700; }
        .btn-scroll { display: inline-block; background-color: #636e72; color: white; padding: 15px 30px; border-radius: 12px; margin-top: 10px; font-size: 1.1rem; font-weight: 700; transition: 0.3s; text-align: center; width: fit-content; }
        .btn-scroll:hover { background-color: #2d3436; transform: translateY(-2px); }

        .rules-card { background-color: var(--dark-blue); color: white; border-radius: var(--radius-main); padding: 40px; box-shadow: var(--card-shadow); }
        .rules-title { color: var(--primary-yellow); font-size: 1.5rem; font-weight: 900; margin-bottom: 30px; display: flex; align-items: center; gap: 10px; }
        .rule-item { display: flex; gap: 15px; margin-bottom: 30px; align-items: flex-start; }
        .check-icon { color: var(--primary-yellow); font-size: 1.2rem; background: rgba(255, 215, 0, 0.2); border-radius: 50%; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .rule-text h4 { font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; color: white; }
        .rule-text p { font-size: 1rem; color: #b2bec3; margin: 0; }
        
        .grade-nav-container { display: flex; justify-content: center; margin-bottom: 50px; padding: 0 20px; position: sticky; top: 85px; z-index: 900; }
        .grade-nav-bar { background: white; padding: 8px 10px; border-radius: 60px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); display: flex; align-items: center; justify-content: center; gap: 5px; width: 100%; max-width: 850px; }
        .grade-tab-btn { flex: 1; text-align: center; padding: 15px 0; border-radius: 40px; color: #b2bec3; font-weight: 700; font-size: 1.1rem; transition: all 0.3s; cursor: pointer; border: none; background: transparent; }
        .grade-tab-btn:hover { color: var(--text-dark); background-color: #f1f2f6; }
        .grade-tab-btn.active { background-color: var(--dark-blue); color: var(--primary-yellow); box-shadow: 0 4px 15px rgba(44, 62, 80, 0.4); }

        .grade-content { max-width: 1200px; margin: 0 auto 100px; padding: 0 20px; display: none; animation: slideUp 0.4s ease-out; }
        .grade-content.active-section { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .section-header { text-align: center; margin-bottom: 50px; }
        .section-header h2 { font-size: 2.2rem; font-weight: 900; color: var(--text-dark); margin-bottom: 10px; }
        .section-header p { color: #636e72; font-size: 1.2rem; font-weight: 500; }
        .cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px; }

        .syllabus-container {
            background: #fff;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border: 2px solid #f0f0f0;
        }
        .syllabus-header {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px dashed #eee; flex-wrap: wrap; gap: 15px;
        }
        .syllabus-title { display: flex; align-items: center; gap: 10px; }
        .syllabus-title h3 { font-size: 1.4rem; color: var(--dark-blue); font-weight: 900; margin: 0; }
        .publisher-tabs { display: flex; gap: 8px; flex-wrap: wrap; }
        .pub-tab {
            padding: 6px 16px;
            border-radius: 20px;
            border: 1px solid #dfe6e9;
            background: white;
            color: #636e72;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.95rem;
        }
        .pub-tab:hover { background: #f1f2f6; }
        .pub-tab.active {
            background: var(--btn-blue);
            color: white;
            border-color: var(--btn-blue);
            box-shadow: 0 4px 10px rgba(9, 132, 227, 0.3);
        }

        .syllabus-semesters { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .semester-block h4 { font-size: 1.1rem; color: #636e72; margin-bottom: 15px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
        .semester-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px; }
        
        .unit-tag {
            background: #f8f9fa; 
            padding: 10px 12px;
            border-radius: 12px; 
            font-size: 0.9rem; 
            color: #2d3436;
            display: flex; align-items: center; gap: 8px; 
            transition: all 0.2s; border: 1px solid transparent;
            white-space: nowrap; 
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
        }
        
        .unit-tag i { color: var(--btn-blue); font-size: 1rem; width: 20px; text-align: center; flex-shrink: 0; }
        .unit-tag .u-num { 
            font-size: 0.8rem; 
            background: #dfe6e9; 
            color: #636e72; 
            padding: 2px 8px; 
            border-radius: 4px; 
            font-weight: 700; 
            margin-right: 4px; 
            flex-shrink: 0;
            min-width: fit-content;
        }
        .unit-tag:hover { 
            background: #fff; 
            border-color: var(--primary-yellow); 
            transform: translateY(-2px); 
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); 
            color: var(--btn-blue);
        }

        .game-card { background: white; border-radius: 20px; padding: 30px 25px; box-shadow: var(--card-shadow); transition: all 0.3s; display: flex; flex-direction: column; position: relative; min-height: 340px; border: 2px solid white; scroll-margin-top: 160px; }
        
        @keyframes flashHighlight {
            0% { border-color: white; box-shadow: var(--card-shadow); }
            50% { border-color: var(--primary-yellow); box-shadow: 0 0 20px rgba(255, 215, 0, 0.6); transform: scale(1.02); }
            100% { border-color: white; box-shadow: var(--card-shadow); transform: scale(1); }
        }
        .game-card.highlight-card { animation: flashHighlight 1.5s ease-in-out; }

        .game-card:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); border-color: #f1f2f6; }
        .status-badge { align-self: flex-start; padding: 6px 12px; border-radius: 8px; font-size: 0.9rem; font-weight: 900; margin-bottom: 20px; display: inline-flex; align-items: center; gap: 6px; }
        .status-badge.open { background-color: #d1f2e6; color: #00b894; }
        
        .card-title { font-size: 1.4rem; font-weight: 900; color: var(--text-dark); margin-bottom: 12px; line-height: 1.4; display: flex; align-items: flex-start; gap: 10px; }
        .card-title i { margin-top: 5px; font-size: 1.2rem; color: #0984e3; }
        
        .keywords { font-size: 0.95rem; color: #636e72; margin-bottom: 25px; flex-grow: 1; font-weight: 500; background: #f8f9fa; padding: 15px; border-radius: 12px; line-height: 1.7; }
        .keywords strong { color: #2d3436; font-weight: 700; display: block; margin-bottom: 5px; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; color: #b2bec3; }

        .card-action { margin-top: auto; }
        .btn-enter { background-color: var(--btn-blue); color: white; text-align: center; padding: 14px; border-radius: 12px; font-weight: 900; font-size: 1.1rem; width: 100%; transition: all 0.2s; border: none; cursor: pointer; box-shadow: 0 4px 15px rgba(9, 132, 227, 0.3); display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-enter:hover { background-color: var(--btn-blue-hover); transform: scale(1.02); }
        
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(44, 62, 80, 0.8); backdrop-filter: blur(5px); z-index: 2000; display: none; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s; }
        .modal-content { background: white; width: 90%; max-width: 500px; border-radius: 30px; padding: 40px; text-align: center; position: relative; transform: scale(0.9); transition: transform 0.3s; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .modal-overlay.active { display: flex; opacity: 1; }
        .modal-overlay.active .modal-content { transform: scale(1); }
        .close-modal-btn { position: absolute; top: 20px; right: 20px; background: #f1f2f6; border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 1.2rem; color: #636e72; cursor: pointer; transition: 0.2s; }
        .close-modal-btn:hover { background: #dfe6e9; color: #2d3436; }
        .modal-title { font-size: 1.6rem; font-weight: 900; margin-bottom: 10px; color: var(--dark-blue); }
        .modal-subtitle { color: #636e72; margin-bottom: 25px; font-weight: 500;}
        .modal-options { display: flex; flex-direction: column; gap: 15px; }
        .modal-option-btn { display: flex; align-items: center; padding: 18px; border-radius: 16px; text-decoration: none; transition: transform 0.2s; color: white; font-weight: 900; font-size: 1.1rem; box-shadow: 0 8px 15px rgba(0,0,0,0.1); border: none; cursor: pointer; justify-content: flex-start; }
        .modal-option-btn:hover { transform: translateY(-3px); filter: brightness(1.05); }
        .modal-option-btn i { font-size: 1.6rem; margin-right: 15px; width: 30px; text-align: center; }
        .btn-modal-game { background: var(--modal-game-bg); }
        .btn-modal-video { background: var(--modal-video-bg); }
        .btn-modal-doc { background: var(--modal-doc-bg); }
        .btn-modal-topicgame { background: var(--modal-topicgame-bg); }
        .btn-modal-disabled { background: #b2bec3; cursor: not-allowed; opacity: 0.7; pointer-events: none; }

        footer { text-align: center; padding: 60px 20px; color: #b2bec3; border-top: 1px solid #eee; margin-top: 80px; background: white; font-weight: 500; }
        
        @media (max-width: 768px) {
            .intro-grid { grid-template-columns: 1fr; }
            .grade-nav-bar { flex-wrap: wrap; border-radius: 30px; padding: 15px; }
            .header-nav { display: none; }
            .intro-headline { font-size: 2rem; }
            .syllabus-semesters { grid-template-columns: 1fr; gap: 20px; }
            .syllabus-header { flex-direction: column; align-items: flex-start; }
            .publisher-tabs { width: 100%; justify-content: space-between; }
            .pub-tab { flex: 1; text-align: center; }
        }
    </style>
</head>
<body>

    <header>
        <div class="header-left">
            <div class="logo-circle">
                <img src="JESSIEMATH-Q.png" alt="Jessie Math Logo">
            </div>
            <div class="header-title-group">
                <div class="main-title">Jessie Math</div>
                <div class="sub-title">æ·ææ•¸å­¸. éŠæˆ²å¤§å»³</div>
            </div>
        </div>
        <nav class="header-nav">
            <a href="https://jessiemath0703-chu.github.io/Game-Lobby/" class="nav-btn active">å¤§å»³é¦–é </a>
            <a href="https://jessiemath0703-chu.github.io/website2/" class="nav-btn text-only">é—œæ–¼è€å¸«</a>
            <a href="https://www.youtube.com/@æ·æJESSIEMATH" class="nav-btn text-only youtube">YouTube é »é“</a>
        </nav>
    </header>

    <section class="intro-section">
        <h1 class="intro-headline">
            å­¸ç¿’ä¸æ˜¯åˆ·é¡Œ<br>
            <span class="highlight-bg">æ˜¯ä¸€å ´ä¸€é—œä¸€é—œçš„å†’éšª</span>
        </h1>
        <p class="intro-subtext">
            æ­¡è¿ä¾†åˆ° Math Hall æ•¸å­¸å¤§å»³ã€‚åœ¨é€™è£¡ï¼Œæ¯ä¸€å€‹å¹´ç´šéƒ½æ˜¯ä¸€å€‹ä¸–ç•Œï¼Œæ¯ä¸€å€‹ä¸»é¡Œï¼Œéƒ½æ˜¯ä¸€æ®µä»»å‹™æ—…ç¨‹ã€‚
        </p>

        <div class="intro-grid">
            <div class="guide-card">
                <div class="guide-title"><i class="fa-solid fa-scroll"></i> å†’éšªæŒ‡å—</div>
                <div class="guide-content">
                    <p>åœ¨æ•¸å­¸å¤§å»³è£¡ï¼Œ<span class="highlight-text">å­©å­ç”¨è‡ªå·±çš„é€Ÿåº¦å‰é€²</span>ã€‚</p>
                    <p>ä½ å¯ä»¥å…ˆç©éŠæˆ²ä¾†ç†Ÿæ‚‰æ¦‚å¿µï¼Œä¹Ÿå¯ä»¥æ­é…å½±ç‰‡èˆ‡ä»»å‹™å–®é€²è¡Œæ·±åº¦ç·´ç¿’ã€‚æˆ‘å€‘ä¸è¿½æ±‚ç§’æ®ºé¡Œç›®ï¼Œè€Œæ˜¯è¿½æ±‚çœŸæ­£çš„ç†è§£ã€‚</p>
                </div>
                <a href="#" class="btn-scroll"><i class="fa-regular fa-folder-open"></i> é ˜å–ä»»å‹™å·è»¸ (PDF ä¸‹è¼‰)</a>
            </div>

            <div class="rules-card">
                <div class="rules-title"><i class="fa-solid fa-shield-halved"></i> å¤§å»³å®ˆå‰‡</div>
                <div class="rule-item">
                    <div class="check-icon"><i class="fa-solid fa-check"></i></div>
                    <div class="rule-text"><h4>æ¯ä¸€é—œéƒ½èƒ½é‡ä¾†</h4><p>å¤±æ•—åªæ˜¯é‚„æ²’æˆåŠŸï¼Œå¤šè©¦å¹¾æ¬¡ï¼</p></div>
                </div>
                <div class="rule-item">
                    <div class="check-icon"><i class="fa-solid fa-check"></i></div>
                    <div class="rule-text"><h4>å…ˆç†è§£ï¼Œå†æ±‚å¿«</h4><p>æƒ³æ¸…æ¥šè¦å‰‡æ¯”äº‚æŒ‰æ›´é‡è¦ã€‚</p></div>
                </div>
                <div class="rule-item">
                    <div class="check-icon"><i class="fa-solid fa-check"></i></div>
                    <div class="rule-text"><h4>æ¯”æ˜¨å¤©çš„è‡ªå·±å¼·</h4><p>é€™æ˜¯å±¬æ–¼ä½ çš„å†’éšªï¼Œä¸æ˜¯æ¯”è³½ã€‚</p></div>
                </div>
            </div>
        </div>
    </section>

    <div class="grade-nav-container">
        <div class="grade-nav-bar">
            <button class="grade-tab-btn active" data-target="grade-1">ä¸€å¹´ç´š</button>
            <button class="grade-tab-btn" data-target="grade-2">äºŒå¹´ç´š</button>
            <button class="grade-tab-btn" data-target="grade-3">ä¸‰å¹´ç´š</button>
            <button class="grade-tab-btn" data-target="grade-4">å››å¹´ç´š</button>
            <button class="grade-tab-btn" data-target="grade-5">äº”å¹´ç´š</button>
            <button class="grade-tab-btn" data-target="grade-6">å…­å¹´ç´š</button>
        </div>
    </div>

    <section id="grade-1" class="grade-content active-section"><div class="section-header"><h2>ğŸ§©ä¸€å¹´ç´šèŒæ–°æ‘</h2><p>åœ¨æ•¸å­—ç¬¬ä¸€æ¬¡ç™¼èŠ½çš„åœ°æ–¹ï¼ŒæŠŠ 1 åˆ° 10 éƒ½è®Šæˆä½ çš„æœ‹å‹ã€‚</p></div><div class="cards-grid" id="g1-container"></div></section>
    <section id="grade-2" class="grade-content"><div class="section-header"><h2>ğŸ§®äºŒå¹´ç´šè©¦ç…‰å ´</h2><p>ç”¨åŠ æ¸›ä¹˜é™¤æ­èµ·æ©‹ï¼Œè®“æ‰€æœ‰é›£é¡Œéƒ½æœ‰è·¯å¯èµ°ã€‚</p></div><div class="cards-grid" id="g2-container"></div></section>
    <section id="grade-3" class="grade-content"><div class="section-header"><h2>ğŸ—ºï¸ä¸‰å¹´ç´šå†’éšªå³¶</h2><p>åˆ†æ•¸ã€è§’åº¦ã€å½¢ç‹€â€¦â€¦ä¸–ç•Œè¶Šåˆ‡è¶Šç´°ï¼Œçœ¼ç›è¶Šçœ‹è¶Šäº®ã€‚</p></div><div class="cards-grid" id="g3-container"></div></section>
    <section id="grade-4" class="grade-content"><div class="section-header"><h2>ğŸ°å››å¹´ç´šå‹‡è€…åŸ</h2><p>å¤§æ•¸é‡ç¾èº«ï¼Œè¨ˆç®—åŠ›å‡ç´šï¼Œé‚è¼¯é–‹å§‹é•·å‡ºè‡ªå·±çš„ç¿…è†€ã€‚</p></div><div class="cards-grid" id="g4-container"></div></section>
    <section id="grade-5" class="grade-content"><div class="section-header"><h2>ğŸ§­ äº”å¹´ç´šæ¢éšªå€</h2><p>ç´¯ç©æŠ€èƒ½ã€ç ´è§£è¦å‰‡ï¼Œæº–å‚™è¿æ¥æ›´æ·±çš„æ•¸å­¸åœ°åœ–ã€‚</p></div><div class="cards-grid" id="g5-container"></div></section>
    <section id="grade-6" class="grade-content"><div class="section-header"><h2>ğŸš€ å…­å¹´ç´šå¤§å†’éšª</h2><p>é€Ÿåº¦ã€æ¯”ä¾‹ã€æœªçŸ¥æ•¸é½Šèšä¸€å ‚â€”â€”æ€è€ƒæ­£å¼é€²åŒ–æˆå†’éšªçš„è¶…èƒ½åŠ›ã€‚</p></div><div class="cards-grid" id="g6-container"></div></section>

    <footer>
        <p id="copyrightLine"></p>
        <p>æ•¸å­¸ä¸è¿·è·¯ï¼ŒJessie å¸¶ä½ èµ°ã€‚</p>
    </footer>

    <div class="modal-overlay" id="resourceModal">
        <div class="modal-content">
            <button class="close-modal-btn" onclick="closeModal()"><i class="fa-solid fa-xmark"></i></button>
            <h3 class="modal-title" id="modalTitle">ä¸»é¡Œæ¨™é¡Œ</h3>
            <p class="modal-subtitle">è«‹é¸æ“‡ä½ è¦é€²è¡Œçš„ä»»å‹™ï¼š</p>
            <div class="modal-options">
                <a href="#" id="modalBasicBtn" class="modal-option-btn btn-modal-game" target="_blank"><i class="fa-solid fa-gamepad"></i> åŸºç¤æŒ‘æˆ°</a>
                <a href="#" id="modalAdvBtn" class="modal-option-btn btn-modal-game" target="_blank"><i class="fa-solid fa-bolt"></i> é€²éšæŒ‘æˆ°</a>
                <a href="#" id="modalTopicGameBtn" class="modal-option-btn btn-modal-topicgame" target="_blank"><i class="fa-solid fa-flag-checkered"></i> ä¸»é¡ŒéŠæˆ²</a>
                <a href="#" id="modalVideoBtn" class="modal-option-btn btn-modal-video" target="_blank"><i class="fa-brands fa-youtube"></i> è§€çœ‹å½±ç‰‡</a>
                <a href="#" id="modalDocBtn" class="modal-option-btn btn-modal-doc" target="_blank"><i class="fa-solid fa-file-pdf"></i> ä»»å‹™æ–‡æª”</a>
            </div>
        </div>
    </div>

    <script>
        // âœ… Footer è‡ªå‹•å¹´ä»½ï¼š2025 ç‚ºå‰µå§‹å¹´ï¼Œä¹‹å¾Œè‡ªå‹•å»¶ä¼¸æˆ 2025â€“YYYY
        (function setAutoCopyright(){
            const startYear = 2025;
            const nowYear = new Date().getFullYear();
            const yearText = (nowYear > startYear) ? `${startYear}â€“${nowYear}` : `${startYear}`;
            const el = document.getElementById('copyrightLine');
            if (el) el.innerHTML = `&copy; ${yearText} Jessie Math æ·æè€å¸«. All rights reserved.`;
        })();

        // --- æ ¸å¿ƒæ•¸æ“šçµæ§‹ ---
        const allGradesData = {
            "grade-1": [
                { id: "g1-u1", title: "10 ä»¥å…§çš„æ•¸", keywords: "1~10 çš„æ•¸ â€¢ é»æ•¸å°æ‡‰ â€¢ èªè­˜ 0", icon: "fa-arrow-up-1-9", semester: 1, gameLinks: { basic: "https://jessiemath01.github.io/First-game1/", advanced: "https://jessiemath01.github.io/First-game1-1/" } },
                { id: "g1-u2", title: "æ¯”é•·çŸ­", keywords: "é•·çŸ­æ¯”è¼ƒ â€¢ é«˜çŸ®ã€åšè–„ã€é è¿‘ â€¢ ç›´ç·šèˆ‡æ›²ç·š", icon: "fa-ruler-vertical", semester: 1 },
                { id: "g1-u3", title: "é †åºèˆ‡å¤šå°‘", keywords: "ç¬¬å¹¾å€‹ (åºæ•¸) â€¢ å‰å¾Œé †åº â€¢ æ•¸é‡æ¯”è¼ƒ", icon: "fa-list-ol", semester: 1 },
                { id: "g1-u4", title: "åˆ†èˆ‡åˆ", keywords: "æ•¸çš„åˆ†è§£ â€¢ æ•¸çš„åˆæˆ â€¢ 10 çš„åˆ†èˆ‡åˆ", icon: "fa-arrows-split-up-and-left", semester: 1 },
                { id: "g1-u5", title: "èªè­˜å½¢ç‹€", keywords: "å¹³é¢åœ–å½¢ â€¢ ç«‹é«”å †ç–Š â€¢ å½¢ç‹€åˆ†é¡", icon: "fa-shapes", semester: 1 },
                { id: "g1-u6", title: "10 ä»¥å…§çš„åŠ æ³•", keywords: "åŠ è™Ÿèˆ‡ç­‰è™Ÿ â€¢ 0 çš„åŠ æ³• â€¢ åœ–åƒåŠ æ³•", icon: "fa-plus", semester: 1 },
                { id: "g1-u7", title: "10 ä»¥å…§çš„æ¸›æ³•", keywords: "æ¸›è™Ÿèªè­˜ â€¢ æ‹¿èµ°èˆ‡å·® â€¢ æ¸› 0 ä¸è®Š", icon: "fa-minus", semester: 1 },
                { id: "g1-u8", title: "30 ä»¥å…§çš„æ•¸", keywords: "æ•¸åˆ° 30 â€¢ åä½æ¦‚å¿µ â€¢ æ•¸çš„é †åº", icon: "fa-arrow-up-1-9", semester: 1 },
                { id: "g1-u9", title: "æ™‚é–“", keywords: "æ•´é»èˆ‡åŠé» â€¢ é•·çŸ­é‡ â€¢ æ™‚é–“é †åº", icon: "fa-clock", semester: 1 },
                { id: "g1-u10", title: "20 ä»¥å…§çš„åŠ æ³•", keywords: "é€²ä½åŠ æ³• â€¢ æ¹Šåæ³• â€¢ ç®—å¼è¦å¾‹", icon: "fa-plus", semester: 2 },
                { id: "g1-u11", title: "é•·åº¦", keywords: "å€‹åˆ¥å–®ä½å¯¦æ¸¬ â€¢ é•·çŸ­æ¯”è¼ƒ â€¢ é•·åº¦åˆæˆ", icon: "fa-ruler-horizontal", semester: 2 },
                { id: "g1-u12", title: "20 ä»¥å…§çš„æ¸›æ³•", keywords: "é€€ä½æ¸›æ³• â€¢ æ¯”è¼ƒå‹æ¸›æ³• â€¢ æ•¸çš„è®ŠåŒ–", icon: "fa-minus", semester: 2 },
                { id: "g1-u13", title: "100 ä»¥å…§çš„æ•¸", keywords: "æ•¸åˆ° 100 â€¢ ä½å€¼ (åä½/å€‹ä½) â€¢ ç™¾æ•¸è¡¨", icon: "fa-table-cells", semester: 2 },
                { id: "g1-u14", title: "å½¢ç‹€èˆ‡ç«‹é«”å½¢é«”", keywords: "å½¢ç‹€æ‹¼æ¹Š â€¢ ç«‹é«”å †ç–Š â€¢ è¦å¾‹æ’åˆ—", icon: "fa-cubes", semester: 2 },
                { id: "g1-u15", title: "éŒ¢å¹£", keywords: "èªè­˜ç¡¬å¹£ â€¢ éŒ¢å¹£æ›ç®— â€¢ ä»˜éŒ¢æ‰¾éŒ¢", icon: "fa-coins", semester: 2 },
                { id: "g1-u16", title: "å¹¾æœˆå¹¾æ—¥æ˜ŸæœŸå¹¾", keywords: "æŸ¥é–±æœˆæ›† â€¢ æ˜ŸæœŸé †åº â€¢ æ—¥æœŸè¨ˆç®—", icon: "fa-calendar-days", semester: 2 },
                { id: "g1-u17", title: "å…©ä½æ•¸çš„åŠ æ¸›æ³•", keywords: "ä¸é€²ä½åŠ æ³• â€¢ ä¸é€€ä½æ¸›æ³• â€¢ ç›´å¼é‹ç®—", icon: "fa-calculator", semester: 2 },
                { id: "g1-u18", title: "åˆ†é¡æ•´ç†", keywords: "ç‰¹å¾µåˆ†é¡ â€¢ ç•«è¨˜çµ±è¨ˆ â€¢ å ±è®€è¡¨æ ¼", icon: "fa-table-list", semester: 2 }
            ],
            "grade-2": [
                { id: "g2-u1", title: "200 ä»¥å…§çš„æ•¸", keywords: "æ•¸åˆ° 200 â€¢ ä½å€¼æ¦‚å¿µ â€¢ é‡‘éŒ¢ä¼°ç®—", icon: "fa-arrow-up-1-9", semester: 1 },
                { id: "g2-u2", title: "äºŒä½æ•¸çš„åŠ æ¸›æ³•", keywords: "ç›´å¼åŠ æ¸› â€¢ å€Ÿä½èˆ‡é€²ä½ â€¢ æ•¸å€¼æ¯”è¼ƒ", icon: "fa-calculator", semester: 1 },
                { id: "g2-u3", title: "èªè­˜å…¬åˆ†", keywords: "èªè­˜å…¬åˆ†(cm) â€¢ ä½¿ç”¨ç›´å°º â€¢ é•·åº¦æ¸¬é‡", icon: "fa-ruler", semester: 1 },
                { id: "g2-u4", title: "åŠ æ¸›æ‡‰ç”¨", keywords: "åŠ æ¸›äº’é€† â€¢ é©—ç®— â€¢ æ–‡å­—æ‡‰ç”¨é¡Œ", icon: "fa-plus-minus", semester: 1 },
                { id: "g2-u5", title: "å®¹é‡", keywords: "èªè­˜å®¹é‡ â€¢ å®¹é‡æ¯”è¼ƒ â€¢ æ¯ç“¶ç¢—ä¼°æ¸¬", icon: "fa-bottle-water", semester: 1 },
                { id: "g2-u6", title: "åŠ æ¸›å…©æ­¥é©Ÿ", keywords: "å…©æ­¥é©Ÿè§£é¡Œ â€¢ é‹ç®—é †åº â€¢ åŠ æ¸›æ··åˆ", icon: "fa-list-ol", semester: 1 },
                { id: "g2-u7", title: "ä¹˜æ³• (ä¸€)", keywords: "é‡è¤‡åŠ æ³• â€¢ ä¹˜æ³•è¡¨(2,4,5,8) â€¢ å€æ•¸æ¦‚å¿µ", icon: "fa-xmark", semester: 1 },
                { id: "g2-u8", title: "æ™‚é–“", keywords: "èªè­˜é˜é¢ â€¢ å¹¾é»å¹¾åˆ† â€¢ æ™‚é–“å ±è®€", icon: "fa-clock", semester: 1 },
                { id: "g2-u9", title: "ä¹˜æ³• (äºŒ)", keywords: "ä¹˜æ³•è¡¨(3,6,7,9) â€¢ ä¹˜æ³•æ‡‰ç”¨ â€¢ ä¹˜æ³•ç†Ÿç·´", icon: "fa-xmark", semester: 1 },
                { id: "g2-u10", title: "é¢çš„å¤§å°æ¯”è¼ƒ", keywords: "é•·æ–¹å½¢èˆ‡æ­£æ–¹å½¢ â€¢ é¢ç©æ¯”è¼ƒ â€¢ å½¢ç‹€è§€å¯Ÿ", icon: "fa-vector-square", semester: 1 },
                { id: "g2-u11", title: "1000 ä»¥å…§çš„æ•¸", keywords: "æ•¸åˆ° 1000 â€¢ ç™¾ä½æ•¸ â€¢ é‡‘éŒ¢æƒ…å¢ƒ", icon: "fa-arrow-up-1-9", semester: 2 },
                { id: "g2-u12", title: "é‡é‡", keywords: "èªè­˜é‡é‡ â€¢ å¤©å¹³ä½¿ç”¨ â€¢ é‡é‡æ¯”è¼ƒ", icon: "fa-weight-hanging", semester: 2 },
                { id: "g2-u13", title: "åŠ åŠ æ¸›æ¸›", keywords: "ä¸‰ä½æ•¸åŠ æ¸› â€¢ é€²ä½å€Ÿä½ â€¢ ä¼°ç®—", icon: "fa-calculator", semester: 2 },
                { id: "g2-u14", title: "å¹³é¢èˆ‡ç«‹é«”åœ–å½¢", keywords: "é‚Š/è§’/é ‚é» â€¢ æ­£æ–¹é«”èˆ‡é•·æ–¹é«” â€¢ åœ–å½¢å‘¨ç•Œ", icon: "fa-shapes", semester: 2 },
                { id: "g2-u15", title: "ä¹˜æ³• (ç‰¹æ®Š)", keywords: "0èˆ‡1çš„ä¹˜æ³• â€¢ 10çš„ä¹˜æ³• â€¢ ä¹˜æ³•è¦å¾‹", icon: "fa-xmark", semester: 2 },
                { id: "g2-u16", title: "å…¬å°ºèˆ‡å…¬åˆ†", keywords: "èªè­˜å…¬å°º(m) â€¢ é•·åº¦æ›ç®— â€¢ é•·åº¦å¯¦æ¸¬", icon: "fa-ruler-combined", semester: 2 },
                { id: "g2-u17", title: "ä¹˜èˆ‡åŠ å…©æ­¥é©Ÿ", keywords: "ä¹˜åŠ /ä¹˜æ¸› â€¢ é™¤åŠ /é™¤æ¸› â€¢ è§£é¡Œç­–ç•¥", icon: "fa-list-check", semester: 2 },
                { id: "g2-u18", title: "å¹´ã€æœˆã€æ—¥", keywords: "æŸ¥çœ‹æœˆæ›† â€¢ å¤§æœˆå°æœˆ â€¢ æ˜ŸæœŸè¨ˆç®—", icon: "fa-calendar-days", semester: 2 },
                { id: "g2-u19", title: "åˆ†è£èˆ‡å¹³åˆ†", keywords: "å¹³å‡åˆ†é… â€¢ åˆ†è£æ´»å‹• â€¢ é™¤æ³•å‰å°", icon: "fa-divide", semester: 2 },
                { id: "g2-u20", title: "èªè­˜åˆ†æ•¸", keywords: "å¹³åˆ†æ¦‚å¿µ â€¢ å¹¾åˆ†ä¹‹ä¸€ â€¢ åœ–å½¢åˆ†æ•¸", icon: "fa-chart-pie", semester: 2 }
            ],
            "grade-3": [
                { id: "g3-u1", title: "ä¸€è¬ä»¥å…§çš„æ•¸", keywords: "ä½å€¼æ¦‚å¿µ â€¢ æ•¸çš„å¤§å°æ¯”è¼ƒ â€¢ æ–°å°å¹£æ‡‰ç”¨", icon: "fa-arrow-up-1-9", semester: 1 },
                { id: "g3-u2", title: "è§’èˆ‡å½¢ç‹€", keywords: "ç›´è§’/éŠ³è§’/éˆè§’ â€¢ æ­£æ–¹å½¢èˆ‡é•·æ–¹å½¢ â€¢ è§’åº¦æ¯”è¼ƒ", icon: "fa-shapes", semester: 1 },
                { id: "g3-u3", title: "ä¸€è¬ä»¥å…§çš„åŠ æ¸›", keywords: "å››ä½æ•¸åŠ æ¸› â€¢ é€²ä½èˆ‡å€Ÿä½ â€¢ æ‡‰ç”¨å•é¡Œ", icon: "fa-calculator", semester: 1 },
                { id: "g3-u4", title: "ä¹˜æ³•", keywords: "äºŒ/ä¸‰ä½æ•¸Ã—ä¸€ä½æ•¸ â€¢ ç›´å¼è¨ˆç®— â€¢ ä¹˜æ³•ä¼°ç®—", icon: "fa-xmark", semester: 1 },
                { id: "g3-u5", title: "æ¯«ç±³èˆ‡æ•¸ç·š", keywords: "æ¯«ç±³(mm)èˆ‡å…¬åˆ†(cm) â€¢ é•·åº¦æ›ç®— â€¢ æ•¸ç·šæ‡‰ç”¨", icon: "fa-ruler-horizontal", semester: 1 },
                { 
                    id: "g3-u6", title: "é™¤æ³• (ä¸€)", keywords: "åˆ†è£èˆ‡å¹³åˆ† â€¢ èªè­˜é¤˜æ•¸ â€¢ ç›´å¼é™¤æ³•åŸºç¤", icon: "fa-divide", semester: 1,
                    gameLinks: { 
                        basic: "https://jessiemath03.github.io/First-game6/", 
                        advanced: "https://jessiemath03.github.io/First-game6-1/",
                        topicGame: "https://jessiemath03.github.io/First-game6-play/"
                    }
                },
                { 
                    id: "g3-u7", title: "å…¬æ–¤èˆ‡å…¬å…‹", keywords: "1å…¬æ–¤=1000å…¬å…‹ â€¢ é‡é‡æ¸¬é‡ â€¢ é‡é‡ä¼°æ¸¬", icon: "fa-weight-hanging", semester: 1,
                    gameLinks: { 
                        basic: "https://jessiemath03.github.io/First-game7/", 
                        advanced: "https://jessiemath03.github.io/First-game7-1/",
                        topicGame: "https://jessiemath03.github.io/First-game7-play/"
                    }
                },
                { 
                    id: "g3-u8", title: "åˆ†æ•¸ (ä¸€)", keywords: "å¹¾åˆ†ä¹‹å¹¾ â€¢ åˆ†æ•¸èˆ‡1çš„é—œä¿‚ â€¢ åˆ†æ•¸æ¯”å¤§å°", icon: "fa-chart-pie", semester: 1,
                    gameLinks: { 
                        basic: "https://jessiemath03.github.io/First-game8/", 
                        advanced: "https://jessiemath03.github.io/First-game8-1/",
                        topicGame: "https://jessiemath03.github.io/First-game8-play/"
                    }
                },
                { id: "g3-u9", title: "åˆ—è¡¨èˆ‡è¦å¾‹", keywords: "ç”Ÿæ´»ä¸­çš„è¡¨æ ¼ â€¢ åœ–å½¢è¦å¾‹ â€¢ æ•¸åˆ—è¦å¾‹", icon: "fa-table-list", semester: 1 },
                { id: "g3-u10", title: "é™¤æ³• (äºŒ)", keywords: "äºŒ/ä¸‰ä½æ•¸Ã·ä¸€ä½æ•¸ â€¢ é™¤æ³•ç­†ç®— â€¢ é¤˜æ•¸æ‡‰ç”¨", icon: "fa-divide", semester: 2 },
                { id: "g3-u11", title: "å…¬å‡èˆ‡æ¯«å‡", keywords: "1å…¬å‡=1000æ¯«å‡ â€¢ å®¹é‡å–®ä½ â€¢ å®¹é‡è¨ˆç®—", icon: "fa-bottle-water", semester: 2 },
                { id: "g3-u12", title: "åˆ†æ•¸çš„åŠ æ³•", keywords: "åŒåˆ†æ¯åŠ æ¸› â€¢ å‡åˆ†æ•¸æ¦‚å¿µ â€¢ åˆ†æ•¸æ‡‰ç”¨", icon: "fa-pizza-slice", semester: 2 },
                { id: "g3-u13", title: "åœ“", keywords: "åœ“å¿ƒ/åŠå¾‘/ç›´å¾‘ â€¢ ä½¿ç”¨åœ“è¦ â€¢ åœ“çš„æ§‹æˆ", icon: "fa-circle-notch", semester: 2 },
                { id: "g3-u14", title: "å…©æ­¥é©Ÿæ‡‰ç”¨å•é¡Œ", keywords: "åŠ æ¸›æ··åˆ â€¢ å…ˆä¹˜å¾ŒåŠ æ¸› â€¢ é‹ç®—é †åº", icon: "fa-list-check", semester: 2 },
                { id: "g3-u15", title: "ä¸€ä½å°æ•¸", keywords: "ååˆ†ä½ â€¢ å°æ•¸æ¯”å¤§å° â€¢ å°æ•¸åŠ æ¸›æ³•", icon: "fa-percent", semester: 2 },
                { id: "g3-u16", title: "æ™‚é–“", keywords: "24å°æ™‚åˆ¶ â€¢ æ™‚/åˆ†/ç§’æ›ç®— â€¢ æ™‚é–“é‡çš„è¨ˆç®—", icon: "fa-clock", semester: 2 },
                { id: "g3-u17", title: "ä¹˜èˆ‡é™¤", keywords: "ä¹˜é™¤äº’é€†é—œä¿‚ â€¢ é©—ç®— â€¢ ä¹˜æ³•ä¼°ç®—", icon: "fa-calculator", semester: 2 },
                { id: "g3-u18", title: "é¢ç©", keywords: "å¹³æ–¹å…¬åˆ† â€¢ æ•¸æ ¼å­ç®—é¢ç© â€¢ åˆ‡å‰²èˆ‡æ‹¼æ¹Š", icon: "fa-vector-square", semester: 2 },
                { id: "g3-u19", title: "å ±è®€è¡¨æ ¼", keywords: "ä¸€ç¶­/äºŒç¶­è¡¨æ ¼ â€¢ äº¤å‰åˆ†é¡ â€¢ è³‡æ–™æ•´ç†", icon: "fa-table", semester: 2 }
            ],
            "grade-4": [
                { id: "g4-u1", title: "åè¬ä»¥å…§çš„æ•¸", keywords: "å¤§æ•¸æ¯”è¼ƒ â€¢ å¤§æ•¸åŠ æ¸› â€¢ ä½å€¼æ¦‚å¿µ", icon: "fa-arrow-up-1-9", semester: 1 },
                { id: "g4-u2", title: "ä¹˜æ³•", keywords: "å››ä½æ•¸Ã—äºŒä½æ•¸ â€¢ äºŒä½æ•¸Ã—äºŒä½æ•¸ â€¢ ä¹˜æ³•äº¤æ›å¾‹", icon: "fa-xmark", semester: 1 },
                { id: "g4-u3", title: "è§’åº¦", keywords: "èªè­˜é‡è§’å™¨ â€¢ æ—‹è½‰è§’ â€¢ è§’åº¦è¨ˆç®— â€¢ åº¦åˆ†ç§’", icon: "fa-compass-drafting", semester: 1 },
                { id: "g4-u4", title: "å‡åˆ†æ•¸èˆ‡å¸¶åˆ†æ•¸", keywords: "å‡åˆ†æ•¸äº’æ› â€¢ å¸¶åˆ†æ•¸æ¯”è¼ƒ â€¢ æ•¸ç·šä¸Šçš„åˆ†æ•¸", icon: "fa-divide", semester: 1 },
                { id: "g4-u5", title: "å…¬é‡Œ", keywords: "èªè­˜å…¬é‡Œ â€¢ å–®ä½æ›ç®— (km/m) â€¢ é•·åº¦è¨ˆç®—", icon: "fa-ruler-combined", semester: 1 },
                { id: "g4-u6", title: "é™¤æ³•", keywords: "äºŒä½æ•¸é™¤æ³• â€¢ ä¸‰ä½æ•¸é™¤æ³• â€¢ è£œé›¶èˆ‡é€€ä½", icon: "fa-divide", semester: 1, gameLinks: { basic: "https://jessiemath04.github.io/First-game6/", advanced: "https://jessiemath04.github.io/First-game6-1/" } },
                { id: "g4-u7", title: "ä¸‰è§’å½¢èˆ‡å…¨ç­‰", keywords: "ä¸‰è§’å½¢åˆ†é¡ â€¢ å…¨ç­‰åœ–å½¢ â€¢ ç•«ä¸‰è§’å½¢", icon: "fa-shapes", semester: 1, gameLinks: { basic: "https://jessiemath04.github.io/First-game7/", advanced: "https://jessiemath04.github.io/First-game7-1/" } },
                { 
                    id: "g4-u8", title: "å…©æ­¥é©Ÿå•é¡Œèˆ‡ä½µå¼", keywords: "åŠ æ¸›å…©æ­¥é©Ÿ â€¢ ä¹˜é™¤å…©æ­¥é©Ÿ â€¢ æ‡‰ç”¨é¡Œè§£é¡Œ", icon: "fa-list-ol", semester: 1,
                    gameLinks: { basic: "https://jessiemath04.github.io/First-game8/", advanced: "https://jessiemath04.github.io/First-game8-1/" }
                },
                { 
                    id: "g4-u9", title: "äºŒä½å°æ•¸", keywords: "ç™¾åˆ†ä½ â€¢ å°æ•¸åŒ–èš â€¢ å°æ•¸åŠ æ¸›", icon: "fa-percent", semester: 1,
                    gameLinks: { basic: "https://jessiemath04.github.io/First-game9/", advanced: "https://jessiemath04.github.io/First-game9-1/" }
                },
                { 
                    id: "g4-u10", title: "çµ±è¨ˆåœ–è¡¨", keywords: "é•·æ¢åœ– â€¢ æŠ˜ç·šåœ– â€¢ åœ–è¡¨åˆ¤è®€ â€¢ è£½ä½œåœ–è¡¨", icon: "fa-chart-column", semester: 1,
                    gameLinks: { 
                        basic: "https://jessiemath04.github.io/First-game10/",
                        topicGame: "https://jessiemath04.github.io/First-game10-play/"
                    }
                },
                { id: "g4-u11", title: "æ¦‚æ•¸", keywords: "å››æ¨äº”å…¥ â€¢ ä¼°ç®— â€¢ è¿‘ä¼¼å€¼ â€¢ ç”Ÿæ´»æ‡‰ç”¨", icon: "fa-scale-balanced", semester: 2 },
                { id: "g4-u12", title: "å››å‰‡é‹ç®—", keywords: "å…ˆä¹˜é™¤å¾ŒåŠ æ¸› â€¢ ç”±å·¦è‡³å³ â€¢ é‹ç®—æ€§è³ª", icon: "fa-calculator", semester: 2 },
                { id: "g4-u13", title: "å‚ç›´å¹³è¡Œèˆ‡å››é‚Šå½¢", keywords: "å‚ç›´ç·š â€¢ å¹³è¡Œç·š â€¢ å››é‚Šå½¢å®¶æ—åˆ†é¡", icon: "fa-lines-leaning", semester: 2 },
                { id: "g4-u14", title: "åˆ†æ•¸ (ä¸€)", keywords: "åŒåˆ†æ¯åŠ æ¸› â€¢ åˆ†æ•¸Ã—æ•´æ•¸ â€¢ åˆ†æ•¸å€", icon: "fa-pizza-slice", semester: 2 },
                { id: "g4-u15", title: "å½¢é«”çš„å¤§å°", keywords: "é«”ç©èªè­˜ â€¢ ç«‹æ–¹å…¬åˆ† â€¢ ç«‹æ–¹å…¬å°º", icon: "fa-cube", semester: 2 },
                { id: "g4-u16", title: "å°æ•¸ä¹˜æ³•", keywords: "å°æ•¸Ã—æ•´æ•¸ â€¢ å°æ•¸é»ä½ç§» â€¢ è¨ˆç®—è¦å¾‹", icon: "fa-xmark", semester: 2 },
                { id: "g4-u17", title: "å‘¨é•·èˆ‡é¢ç©", keywords: "å‘¨é•·å…¬å¼ â€¢ é¢ç©å…¬å¼ â€¢ å¹³æ–¹å–®ä½æ›ç®—", icon: "fa-vector-square", semester: 2 },
                { id: "g4-u18", title: "åˆ†æ•¸ (äºŒ)", keywords: "ç­‰å€¼åˆ†æ•¸ â€¢ ç•°åˆ†æ¯æ¯”è¼ƒ â€¢ åˆ†æ•¸å°æ•¸è½‰æ›", icon: "fa-divide", semester: 2 },
                { id: "g4-u19", title: "æ™‚é–“çš„è¨ˆç®—", keywords: "24å°æ™‚åˆ¶ â€¢ æ™‚é–“æ›ç®— â€¢ è·¨æ—¥è¨ˆç®—", icon: "fa-clock", semester: 2 },
                { id: "g4-u20", title: "è¦å¾‹", keywords: "æ•¸çš„è¦å¾‹ â€¢ å¥‡å¶æ•¸è¦å¾‹ â€¢ åœ–æ¡ˆè¦å¾‹", icon: "fa-lightbulb", semester: 2 },
                { id: "g4-u21", title: "å¤šä½æ•¸çš„ä¹˜èˆ‡é™¤", keywords: "å¤šä½æ•¸ä¹˜é™¤ â€¢ é€²ä½è™•ç† â€¢ é€€ä½è™•ç†", icon: "fa-calculator", semester: 2 }
            ],
            "grade-5": [
                { id: "g5-u1", title: "æŠ˜ç·šåœ–", keywords: "é•·æ¢åœ– vs æŠ˜ç·šåœ– â€¢ è¶¨å‹¢è®ŠåŒ– â€¢ è£½ä½œæŠ˜ç·šåœ–", icon: "fa-chart-line", semester: 1 },
                { id: "g5-u2", title: "å€æ•¸èˆ‡å› æ•¸", keywords: "æ•´é™¤æ¦‚å¿µ â€¢ å› æ•¸èˆ‡å€æ•¸ â€¢ å…¬å› æ•¸ (GCD)", icon: "fa-sitemap", semester: 1 },
                { id: "g5-u3", title: "å¹³é¢åœ–å½¢", keywords: "ä¸‰è§’å½¢å…§è§’å’Œ (180Â°) â€¢ å¹³è¡Œå››é‚Šå½¢ â€¢ æ¢¯å½¢", icon: "fa-shapes", semester: 1 },
                { id: "g5-u4", title: "å…¬å€æ•¸èˆ‡å…¬å› æ•¸", keywords: "å…¬å› æ•¸å’Œæœ€å¤§å…¬å› æ•¸ â€¢ å…¬å€æ•¸å’Œæœ€å°å…¬å€æ•¸", icon: "fa-users-viewfinder", semester: 1 },
                { id: "g5-u5", title: "ç«‹é«”å½¢é«”", keywords: "æŸ±é«” (è§’æŸ±/åœ“æŸ±) â€¢ éŒé«” (è§’éŒ/åœ“éŒ) â€¢ çƒé«”", icon: "fa-cubes", semester: 1 },
                { id: "g5-u6", title: "å››å‰‡é‹ç®—", keywords: "å…ˆä¹˜é™¤å¾ŒåŠ æ¸› â€¢ æ‹¬è™Ÿå„ªå…ˆ â€¢ åˆ†é…å¾‹", icon: "fa-calculator", semester: 1, gameLinks: { basic: "https://jessiemath05.github.io/First-game6/", advanced: "https://jessiemath05.github.io/First-game6-1/" } },
                { id: "g5-u7", title: "æ“´åˆ†ç´„åˆ†èˆ‡åŠ æ¸›", keywords: "æ“´åˆ†èˆ‡ç´„åˆ† â€¢ é€šåˆ† â€¢ ç•°åˆ†æ¯åŠ æ¸›", icon: "fa-divide", semester: 1, gameLinks: { basic: "https://jessiemath05.github.io/First-game7/", advanced: "https://jessiemath05.github.io/First-game7-1/" } },
                { id: "g5-u8", title: "é¢ç©", keywords: "å¹³è¡Œå››é‚Šå½¢å…¬å¼ â€¢ ä¸‰è§’å½¢å…¬å¼ â€¢ æ¢¯å½¢å…¬å¼", icon: "fa-vector-square", semester: 1, gameLinks: { basic: "https://jessiemath05.github.io/First-game8/", advanced: "https://jessiemath05.github.io/First-game8-1/" } },
                { id: "g5-u9", title: "ä¹˜ä»¥å¹¾åˆ†ä¹‹ä¸€", keywords: "åˆ†æ•¸ä¹˜æ³•æ¦‚å¿µ â€¢ æ•´æ•¸ Ã— åˆ†æ•¸", icon: "fa-xmark", semester: 1, gameLinks: { basic: "https://jessiemath05.github.io/First-game9/", advanced: "https://jessiemath05.github.io/First-game9-1/" } },
                { id: "g5-u10", title: "æ‰‡å½¢", keywords: "èªè­˜æ‰‡å½¢ â€¢ èªè­˜åœ“å¿ƒè§’ â€¢ å¹¾åˆ†ä¹‹å¹¾åœ“", icon: "fa-circle-notch", semester: 1, gameLinks: { basic: "https://jessiemath05.github.io/First-game10/", advanced: "https://jessiemath05.github.io/First-game10-1/" } },
                { id: "g5-u11", title: "æ•¸çš„åé€²ä½çµæ§‹", keywords: "å„„ä»¥ä¸Šå¤§æ•¸ â€¢ å¤šä½å°æ•¸", icon: "fa-arrow-up-1-9", semester: 2 },
                { id: "g5-u12", title: "åˆ†æ•¸çš„è¨ˆç®—", keywords: "åˆ†æ•¸ Ã— åˆ†æ•¸ â€¢ åˆ†æ•¸ Ã· æ•´æ•¸", icon: "fa-percent", semester: 2 },
                { id: "g5-u13", title: "é«”ç©", keywords: "é•·æ–¹é«”èˆ‡æ­£æ–¹é«” â€¢ 1ç«‹æ–¹å…¬åˆ†", icon: "fa-cube", semester: 2 },
                { id: "g5-u14", title: "å°æ•¸ (ä¹˜é™¤èˆ‡ä¼°ç®—)", keywords: "å°æ•¸é»ç§»ä½ â€¢ å•†èˆ‡é¤˜æ•¸", icon: "fa-calculator", semester: 2 },
                { id: "g5-u15", title: "ç”Ÿæ´»ä¸­çš„å¤§å–®ä½", keywords: "å…¬å™¸ (t) â€¢ å…¬ç• (a) â€¢ å…¬é ƒ (ha)", icon: "fa-ruler-combined", semester: 2 },
                { id: "g5-u16", title: "æ™‚é–“çš„ä¹˜é™¤", keywords: "æ™‚åˆ†ç§’æ›ç®— â€¢ æ™‚é–“ç¶“é", icon: "fa-clock", semester: 2 },
                { id: "g5-u17", title: "å®¹ç©", keywords: "å…¬å‡èˆ‡æ¯«å‡ â€¢ æ’æ°´æ³•", icon: "fa-glass-water", semester: 2 },
                { id: "g5-u18", title: "æ¯”ç‡èˆ‡ç™¾åˆ†ç‡", keywords: "æ¯”ç‡ â€¢ ç™¾åˆ†ç‡ (%) â€¢ æŠ˜æ‰£è¨ˆç®—", icon: "fa-percent", semester: 2 },
                { id: "g5-u19", title: "è¡¨é¢ç©", keywords: "å±•é–‹åœ– â€¢ 6å€‹é¢ç¸½å’Œ", icon: "fa-box-open", semester: 2 },
                { id: "g5-u20", title: "ç·šå°ç¨±åœ–å½¢", keywords: "å°ç¨±è»¸ â€¢ å°ç¨±é» â€¢ å°ç¨±åœ–å½¢ç¹ªè£½", icon: "fa-object-group", semester: 2 },
                { id: "g5-u21", title: "å°æ•¸çš„åŠ æ¸›", keywords: "å¤šä½å°æ•¸ â€¢ å°æ•¸æ¯”å¤§å°", icon: "fa-list-ol", semester: 2 }
            ],
            "grade-6": [
                { id: "g6-u1", title: "è³ªå› æ•¸èˆ‡çŸ­é™¤æ³•", keywords: "è³ªæ•¸èˆ‡åˆæ•¸ â€¢ çŸ­é™¤æ³•", icon: "fa-cubes-stacked", semester: 1 },
                { id: "g6-u2", title: "åˆ†æ•¸é™¤æ³•", keywords: "æœ€ç°¡åˆ†æ•¸ â€¢ å€’æ•¸", icon: "fa-divide", semester: 1 },
                { id: "g6-u3", title: "è¦å¾‹å•é¡Œ", keywords: "é–“éš”å•é¡Œ â€¢ æ‰¾è¦å‰‡", icon: "fa-lightbulb", semester: 1 },
                { id: "g6-u4", title: "æ¯”èˆ‡æ¯”å€¼", keywords: "ç›¸ç­‰çš„æ¯” â€¢ æœ€ç°¡æ•´æ•¸æ¯”", icon: "fa-scale-unbalanced", semester: 1 },
                { id: "g6-u5", title: "å°æ•¸é™¤æ³•", keywords: "å°æ•¸é»ç§»ä½ â€¢ å•†èˆ‡é¤˜æ•¸", icon: "fa-percent", semester: 1 },

                { id: "g6-u6", title: "å…©é‡é—œä¿‚èˆ‡æ¯”", keywords: "åŸºæº–é‡ vs æ¯”è¼ƒé‡ â€¢ æ¯å­å’Œå·®", icon: "fa-arrows-left-right-to-line", semester: 1,
                  gameLinks: { basic: "https://jessiemath06.github.io/First-game6/", advanced: "https://jessiemath06.github.io/First-game6-1/", topicGame: "https://jessiemath06.github.io/First-game6-play/" } },

                { id: "g6-u7", title: "åœ“èˆ‡æ‰‡å½¢å‘¨é•·", keywords: "åœ“å‘¨ç‡(Ï€) â€¢ ç›´å¾‘ Ã— 3.14", icon: "fa-circle-notch", semester: 1,
                  gameLinks: { basic: "https://jessiemath06.github.io/First-game7/", advanced: "https://jessiemath06.github.io/First-game7-1/", topicGame: "https://jessiemath06.github.io/First-game7-play/" } },

                { id: "g6-u8", title: "æ”¾å¤§ã€ç¸®å°èˆ‡æ¯”ä¾‹å°º", keywords: "ç›¸ä¼¼åœ–å½¢ â€¢ æ¯”ä¾‹å°ºè¨ˆç®—", icon: "fa-magnifying-glass-plus", semester: 1,
                  gameLinks: { basic: "https://jessiemath06.github.io/First-game8/", advanced: "https://jessiemath06.github.io/First-game8-1/", topicGame: "https://jessiemath06.github.io/First-game8-play/" } },

                { id: "g6-u9", title: "æ€æ¨£è§£é¡Œ (ä¸€)", keywords: "å’Œå·®å•é¡Œ â€¢ é›å…”åŒç± ", icon: "fa-puzzle-piece", semester: 1,
                  gameLinks: { basic: "https://jessiemath06.github.io/First-game9/", advanced: "https://jessiemath06.github.io/First-game9-1/", topicGame: "https://jessiemath06.github.io/First-game9-play/" } },

                { id: "g6-u10", title: "åˆ†æ•¸å°æ•¸å››å‰‡", keywords: "æ··åˆé‹ç®— â€¢ ç°¡åŒ–è¨ˆç®—", icon: "fa-calculator", semester: 2 },

                { id: "g6-u11", title: "åœ“èˆ‡æ‰‡å½¢é¢ç©", keywords: "åŠå¾‘ Ã— åŠå¾‘ Ã— 3.14", icon: "fa-shapes", semester: 2,
                  gameLinks: { basic: "https://jessiemath06.github.io/First-game11/", advanced: "https://jessiemath06.github.io/First-game11-1/", topicGame: "https://jessiemath06.github.io/First-game11-play/" } },

                { id: "g6-u12", title: "é€Ÿç‡", keywords: "è·é›¢-æ™‚é–“-é€Ÿç‡ â€¢ å–®ä½æ›ç®—", icon: "fa-gauge-high", semester: 2,
                  gameLinks: { basic: "https://jessiemath06.github.io/First-game12/", advanced: "https://jessiemath06.github.io/First-game12-1/", topicGame: "https://jessiemath06.github.io/First-game12-play/" } },

                { id: "g6-u13", title: "çµ±è¨ˆåœ–è¡¨", keywords: "åœ“å½¢åœ–ç¹ªè£½ â€¢ ç™¾åˆ†æ¯”è¨ˆç®—", icon: "fa-chart-pie", semester: 2 },
                { id: "g6-u14", title: "æ€æ¨£è§£é¡Œ (äºŒ)", keywords: "æµæ°´å•é¡Œ â€¢ å¹´é½¡å•é¡Œ", icon: "fa-brain", semester: 2 },
                { id: "g6-u15", title: "è§’æŸ±èˆ‡åœ“æŸ±", keywords: "æŸ±é«”é«”ç© â€¢ è¡¨é¢ç©å±•é–‹åœ–", icon: "fa-cubes", semester: 2 }
            ]
        };

        /* =========================================================
           âœ… æ–°å¢ï¼šå‡ºç‰ˆç¤¾å°ç…§è³‡æ–™ï¼ˆç”¨ä¾†ç”¢ç”Ÿä¸Š/ä¸‹å­¸æœŸæ¸…å–®ï¼Œé»æ“Šå¯è·³åˆ°ä¸‹æ–¹å¡ç‰‡ï¼‰
           - ä¸å‹•åŸæœ¬ cardsï¼ˆä»ä½¿ç”¨ allGradesData çµ±ä¸€è³‡æ–™ï¼‰
        ========================================================= */
        const publisherData = {
            "grade-1": {
                unified: {
                    s1: [
                        { label:"10 ä»¥å…§çš„æ•¸", target:"g1-u1" },
                        { label:"æ¯”é•·çŸ­", target:"g1-u2" },
                        { label:"é †åºèˆ‡å¤šå°‘", target:"g1-u3" },
                        { label:"åˆ†èˆ‡åˆ", target:"g1-u4" },
                        { label:"èªè­˜å½¢ç‹€", target:"g1-u5" },
                        { label:"10 ä»¥å…§çš„åŠ æ³•", target:"g1-u6" },
                        { label:"10 ä»¥å…§çš„æ¸›æ³•", target:"g1-u7" },
                        { label:"30 ä»¥å…§çš„æ•¸", target:"g1-u8" },
                        { label:"æ™‚é–“", target:"g1-u9" }
                    ],
                    s2: [
                        { label:"20 ä»¥å…§çš„åŠ æ³•", target:"g1-u10" },
                        { label:"é•·åº¦", target:"g1-u11" },
                        { label:"20 ä»¥å…§çš„æ¸›æ³•", target:"g1-u12" },
                        { label:"100 ä»¥å…§çš„æ•¸", target:"g1-u13" },
                        { label:"å½¢ç‹€èˆ‡ç«‹é«”å½¢é«”", target:"g1-u14" },
                        { label:"éŒ¢å¹£", target:"g1-u15" },
                        { label:"å¹¾æœˆå¹¾æ—¥æ˜ŸæœŸå¹¾", target:"g1-u16" },
                        { label:"å…©ä½æ•¸çš„åŠ æ¸›æ³•", target:"g1-u17" },
                        { label:"åˆ†é¡æ•´ç†", target:"g1-u18" }
                    ]
                },
                nanYi: {
                    s1: [
                        { label:"æ•¸åˆ° 10", target:"g1-u1" },
                        { label:"æ¯”é•·çŸ­", target:"g1-u2" },
                        { label:"åˆ†èˆ‡åˆ", target:"g1-u4" },
                        { label:"é †åºå’Œå¤šå°‘", target:"g1-u3" },
                        { label:"æ•¸åˆ° 30", target:"g1-u8" },
                        { label:"åŠ ä¸€åŠ ", target:"g1-u6" },
                        { label:"èªè­˜å½¢ç‹€", target:"g1-u5" },
                        { label:"æ¸›ä¸€æ¸›èˆ‡åŠ æ¸›æ‡‰ç”¨", target:"g1-u7" },
                        { label:"è®€é˜éŒ¶", target:"g1-u9" }
                    ],
                    s2: [
                        { label:"æ•¸åˆ° 100", target:"g1-u13" },
                        { label:"18 ä»¥å…§çš„åŠ æ³•", target:"g1-u10" },
                        { label:"é•·åº¦", target:"g1-u11" },
                        { label:"18 ä»¥å…§çš„æ¸›æ³•", target:"g1-u12" },
                        { label:"åœ–å½¢å’Œå½¢é«”", target:"g1-u14" },
                        { label:"å¹¾æœˆå¹¾æ—¥", target:"g1-u16" },
                        { label:"éŒ¢å¹£", target:"g1-u15" },
                        { label:"äºŒä½æ•¸çš„åŠ æ¸›", target:"g1-u17" },
                        { label:"åšç´€éŒ„", target:"g1-u18" }
                    ]
                },
                hanLin: null, // æœƒè‡ªå‹• fallback åˆ° unified
                kangXuan: {
                    s1: [
                        { label:"10 ä»¥å…§çš„æ•¸", target:"g1-u1" },
                        { label:"æ¯”é•·çŸ­", target:"g1-u2" },
                        { label:"æ’é †åºã€æ¯”å¤šå°‘", target:"g1-u3" },
                        { label:"åˆ†èˆ‡åˆ", target:"g1-u4" },
                        { label:"æ–¹ç›’ã€åœ“ç½ã€çƒ", target:"g1-u14" },
                        { label:"30 ä»¥å…§çš„æ•¸", target:"g1-u8" },
                        { label:"10 ä»¥å…§çš„åŠ æ³•", target:"g1-u6" },
                        { label:"10 ä»¥å…§çš„æ¸›æ³•", target:"g1-u7" },
                        { label:"å¹¾é»é˜", target:"g1-u9" }
                    ],
                    s2: [
                        { label:"50 ä»¥å…§çš„æ•¸", target:"g1-u13" },
                        { label:"18 ä»¥å…§çš„åŠ æ³•", target:"g1-u10" },
                        { label:"åœ–å½¢èˆ‡åˆ†é¡", target:"g1-u18" },
                        { label:"18 ä»¥å…§çš„æ¸›æ³•", target:"g1-u12" },
                        { label:"æœ‰å¤šé•·", target:"g1-u11" },
                        { label:"100 ä»¥å…§çš„æ•¸", target:"g1-u13" },
                        { label:"èªè­˜éŒ¢å¹£", target:"g1-u15" },
                        { label:"äºŒä½æ•¸çš„åŠ æ¸›", target:"g1-u17" },
                        { label:"å¹¾æœˆå¹¾æ—¥æ˜ŸæœŸå¹¾", target:"g1-u16" }
                    ]
                }
            },

            "grade-2": {
                unified: null, // fallback to allGradesData (ç¿°æ—è·¯ç·š)
                nanYi: {
                    s1: [
                        { label:"æ•¸åˆ° 300", target:"g2-u1" },
                        { label:"äºŒä½æ•¸çš„åŠ æ¸›", target:"g2-u2" },
                        { label:"å¹¾å…¬åˆ†", target:"g2-u3" },
                        { label:"åŠ æ¸›çš„é—œä¿‚èˆ‡æ‡‰ç”¨", target:"g2-u4" },
                        { label:"å®¹é‡", target:"g2-u5" },
                        { label:"å…©æ­¥é©Ÿçš„åŠ æ¸›", target:"g2-u6" },
                        { label:"2ã€5ã€4ã€8 çš„ä¹˜æ³•", target:"g2-u7" },
                        { label:"å¹¾æ™‚å¹¾åˆ†", target:"g2-u8" },
                        { label:"3ã€6ã€7ã€9 çš„ä¹˜æ³•", target:"g2-u9" },
                        { label:"å¹³é¢åœ–å½¢", target:"g2-u14" }
                    ],
                    s2: [
                        { label:"æ•¸åˆ° 1000", target:"g2-u11" },
                        { label:"åŠ åŠ æ¸›æ¸›", target:"g2-u13" },
                        { label:"å¹¾å…¬å°º", target:"g2-u16" },
                        { label:"å¹´æœˆæ—¥", target:"g2-u18" },
                        { label:"0ã€1ã€10 çš„ä¹˜æ³•", target:"g2-u15" },
                        { label:"é‡é‡", target:"g2-u12" },
                        { label:"å…©æ­¥é©Ÿçš„ä¹˜æ³•", target:"g2-u17" },
                        { label:"åˆ†æ±è¥¿", target:"g2-u19" },
                        { label:"å–®ä½åˆ†æ•¸", target:"g2-u20" },
                        { label:"é¢çš„å¤§å°èˆ‡ç«‹é«”", target:"g2-u10" }
                    ]
                },
                hanLin: {
                    s1: [
                        { label:"200 ä»¥å…§çš„æ•¸", target:"g2-u1" },
                        { label:"äºŒä½æ•¸çš„åŠ æ¸›æ³•", target:"g2-u2" },
                        { label:"èªè­˜å…¬åˆ†", target:"g2-u3" },
                        { label:"åŠ æ¸›æ‡‰ç”¨", target:"g2-u4" },
                        { label:"å®¹é‡", target:"g2-u5" },
                        { label:"åŠ æ¸›å…©æ­¥é©Ÿ", target:"g2-u6" },
                        { label:"ä¹˜æ³• (ä¸€)", target:"g2-u7" },
                        { label:"æ™‚é–“", target:"g2-u8" },
                        { label:"ä¹˜æ³• (äºŒ)", target:"g2-u9" },
                        { label:"é¢çš„å¤§å°æ¯”è¼ƒ", target:"g2-u10" }
                    ],
                    s2: [
                        { label:"1000 ä»¥å…§çš„æ•¸", target:"g2-u11" },
                        { label:"é‡é‡", target:"g2-u12" },
                        { label:"åŠ åŠ æ¸›æ¸›", target:"g2-u13" },
                        { label:"å¹³é¢åœ–å½¢èˆ‡ç«‹é«”å½¢é«”", target:"g2-u14" },
                        { label:"ä¹˜æ³•", target:"g2-u15" },
                        { label:"å…¬å°ºèˆ‡å…¬åˆ†", target:"g2-u16" },
                        { label:"ä¹˜èˆ‡åŠ å…©æ­¥é©Ÿ", target:"g2-u17" },
                        { label:"å¹´ã€æœˆã€æ—¥", target:"g2-u18" },
                        { label:"åˆ†è£èˆ‡å¹³åˆ†", target:"g2-u19" },
                        { label:"èªè­˜åˆ†æ•¸", target:"g2-u20" }
                    ]
                },
                kangXuan: {
                    s1: [
                        { label:"200 ä»¥å…§çš„æ•¸", target:"g2-u1" },
                        { label:"äºŒä½æ•¸çš„ç›´å¼åŠ æ¸›", target:"g2-u2" },
                        { label:"é‡é•·åº¦", target:"g2-u3" },
                        { label:"åŠ æ¸›é—œä¿‚èˆ‡æ‡‰ç”¨", target:"g2-u4" },
                        { label:"é¢ç©å¤§å°çš„æ¯”è¼ƒ", target:"g2-u10" },
                        { label:"å…©æ­¥é©Ÿçš„åŠ æ¸›", target:"g2-u6" },
                        { label:"2ã€5ã€4ã€8 çš„ä¹˜æ³•", target:"g2-u7" },
                        { label:"å¹¾æ™‚å¹¾åˆ†", target:"g2-u8" },
                        { label:"3ã€6ã€9ã€7 çš„ä¹˜æ³•", target:"g2-u9" },
                        { label:"å®¹é‡èˆ‡é‡é‡", target:"g2-u5" }
                    ],
                    s2: [
                        { label:"1000 ä»¥å…§çš„æ•¸", target:"g2-u11" },
                        { label:"ä¸‰ä½æ•¸çš„åŠ æ¸›", target:"g2-u13" },
                        { label:"å¹³é¢åœ–å½¢", target:"g2-u14" },
                        { label:"å¹´ã€æœˆã€æ—¥", target:"g2-u18" },
                        { label:"ä¹˜æ³•", target:"g2-u15" },
                        { label:"å…©æ­¥é©Ÿæ‡‰ç”¨å•é¡Œ", target:"g2-u17" },
                        { label:"å…¬å°ºå’Œå…¬åˆ†", target:"g2-u16" },
                        { label:"åˆ†é¡èˆ‡ç«‹é«”åœ–å½¢", target:"g2-u14" },
                        { label:"åˆ†åˆ†çœ‹", target:"g2-u19" },
                        { label:"åˆ†æ•¸", target:"g2-u20" }
                    ]
                }
            },

            "grade-3": {
                unified: null,
                nanYi: {
                    s1: [
                        { label:"æ•¸åˆ° 10000", target:"g3-u1" },
                        { label:"å››ä½æ•¸çš„åŠ æ¸›", target:"g3-u3" },
                        { label:"ä¹˜æ³•", target:"g3-u4" },
                        { label:"å¹¾æ¯«ç±³", target:"g3-u5" },
                        { label:"è§’ã€æ­£æ–¹å½¢å’Œé•·æ–¹å½¢", target:"g3-u2" },
                        { label:"é™¤æ³•", target:"g3-u6" },
                        { label:"æ‰¾è¦å¾‹", target:"g3-u9" },
                        { label:"åˆ†æ•¸", target:"g3-u8" },
                        { label:"åœ“", target:"g3-u13" }
                    ],
                    s2: [
                        { label:"é™¤æ³•", target:"g3-u10" },
                        { label:"å…¬å‡å’Œæ¯«å‡", target:"g3-u11" },
                        { label:"æ™‚é–“", target:"g3-u16" },
                        { label:"å…©æ­¥é©Ÿçš„è¨ˆç®—", target:"g3-u14" },
                        { label:"é¢ç©", target:"g3-u18" },
                        { label:"å…¬æ–¤å’Œå…¬å…‹", target:"g3-u7" },
                        { label:"åˆ†æ•¸çš„åŠ æ¸›", target:"g3-u12" },
                        { label:"ä¹˜é™¤çš„æ‡‰ç”¨", target:"g3-u17" },
                        { label:"å°æ•¸", target:"g3-u15" },
                        { label:"å ±è®€è¡¨æ ¼", target:"g3-u19" }
                    ]
                },
                hanLin: null,
                kangXuan: {
                    s1: [
                        { label:"10000 ä»¥å…§çš„æ•¸", target:"g3-u1" },
                        { label:"å››ä½æ•¸çš„åŠ æ¸›", target:"g3-u3" },
                        { label:"æ¯«ç±³", target:"g3-u5" },
                        { label:"ä¹˜æ³•", target:"g3-u4" },
                        { label:"è§’", target:"g3-u2" },
                        { label:"é¢ç©", target:"g3-u18" },
                        { label:"é™¤æ³•", target:"g3-u6" },
                        { label:"å…¬å‡å’Œæ¯«å‡", target:"g3-u11" },
                        { label:"åˆ†æ•¸", target:"g3-u8" }
                    ],
                    s2: [
                        { label:"åˆ†æ•¸çš„åŠ æ¸›", target:"g3-u12" },
                        { label:"é™¤æ³•", target:"g3-u10" },
                        { label:"å°‹æ‰¾è¦å¾‹", target:"g3-u9" },
                        { label:"å…¬æ–¤å’Œå…¬å…‹", target:"g3-u7" },
                        { label:"å°æ•¸", target:"g3-u15" },
                        { label:"åœ“", target:"g3-u13" },
                        { label:"ä¹˜æ³•èˆ‡é™¤æ³•", target:"g3-u17" },
                        { label:"æ™‚é–“", target:"g3-u16" },
                        { label:"çµ±è¨ˆè¡¨", target:"g3-u19" }
                    ]
                }
            },

            "grade-4": {
                unified: null,
                nanYi: {
                    s1: [
                        { label:"ä¸€å„„ä»¥å…§çš„æ•¸", target:"g4-u1" },
                        { label:"ä¹˜æ³•", target:"g4-u2" },
                        { label:"è§’åº¦", target:"g4-u3" },
                        { label:"é™¤æ³•", target:"g4-u6" },
                        { label:"ä¸‰è§’å½¢", target:"g4-u7" },
                        { label:"åˆ†æ•¸", target:"g4-u4" },
                        { label:"æ•¸é‡é—œä¿‚", target:"g4-u8" },
                        { label:"æ•´æ•¸å››å‰‡", target:"g4-u12" },
                        { label:"å°æ•¸", target:"g4-u9" },
                        { label:"é•·åº¦", target:"g4-u5" }
                    ],
                    s2: [
                        { label:"å¤šä½æ•¸çš„ä¹˜èˆ‡é™¤", target:"g4-u21" },
                        { label:"å››é‚Šå½¢", target:"g4-u13" },
                        { label:"åˆ†æ•¸çš„åŠ æ¸›å’Œæ•´æ•¸å€", target:"g4-u14" },
                        { label:"æ¦‚æ•¸", target:"g4-u11" },
                        { label:"çµ±è¨ˆåœ–è¡¨", target:"g4-u10" },
                        { label:"å°æ•¸ä¹˜ä»¥æ•´æ•¸", target:"g4-u16" },
                        { label:"å‘¨é•·èˆ‡é¢ç©", target:"g4-u17" },
                        { label:"ç­‰å€¼åˆ†æ•¸", target:"g4-u18" },
                        { label:"æ™‚é–“çš„åŠ æ¸›", target:"g4-u19" },
                        { label:"ç«‹æ–¹å…¬åˆ†", target:"g4-u15" }
                    ]
                },
                hanLin: null,
                kangXuan: {
                    s1: [
                        { label:"ä¸€å„„ä»¥å…§çš„æ•¸", target:"g4-u1" },
                        { label:"æ•´æ•¸çš„ä¹˜æ³•", target:"g4-u2" },
                        { label:"è§’åº¦", target:"g4-u3" },
                        { label:"æ•´æ•¸çš„é™¤æ³•", target:"g4-u6" },
                        { label:"å…¬é‡Œ", target:"g4-u5" },
                        { label:"ä¸‰è§’å½¢", target:"g4-u7" },
                        { label:"å°æ•¸", target:"g4-u9" },
                        { label:"æ•´æ•¸å››å‰‡è¨ˆç®—", target:"g4-u12" },
                        { label:"åˆ†æ•¸", target:"g4-u4" },
                        { label:"çµ±è¨ˆåœ–", target:"g4-u10" }
                    ],
                    s2: [
                        { label:"å¤šä½æ•¸çš„ä¹˜èˆ‡é™¤", target:"g4-u21" },
                        { label:"å››é‚Šå½¢", target:"g4-u13" },
                        { label:"æ¦‚æ•¸", target:"g4-u11" },
                        { label:"æ•¸é‡è¦å¾‹", target:"g4-u20" },
                        { label:"å°æ•¸ä¹˜æ³•", target:"g4-u16" },
                        { label:"å‘¨é•·èˆ‡é¢ç©", target:"g4-u17" },
                        { label:"ç­‰å€¼åˆ†æ•¸", target:"g4-u18" },
                        { label:"ç°¡åŒ–è¨ˆç®—", target:"g4-u12" },
                        { label:"æ™‚é–“çš„è¨ˆç®—", target:"g4-u19" },
                        { label:"ç«‹æ–¹å…¬åˆ†", target:"g4-u15" }
                    ]
                }
            },

            "grade-5": {
                unified: null,
                nanYi: {
                    s1: [
                        { label:"é•·æ¢åœ–å’ŒæŠ˜ç·šåœ–", target:"g5-u1" },
                        { label:"å› æ•¸å’Œå€æ•¸", target:"g5-u2" },
                        { label:"å¤šé‚Šå½¢", target:"g5-u3" },
                        { label:"æ“´åˆ†ã€ç´„åˆ†å’Œé€šåˆ†", target:"g5-u7" },
                        { label:"ç·šå°ç¨±åœ–å½¢", target:"g5-u20" },
                        { label:"ç•°åˆ†æ¯åˆ†æ•¸çš„åŠ æ¸›", target:"g5-u7" },
                        { label:"æ•´æ•¸å››å‰‡è¨ˆç®—", target:"g5-u6" },
                        { label:"å¹³è¡Œå››é‚Šå½¢ã€ä¸‰è§’å½¢å’Œæ¢¯å½¢çš„é¢ç©", target:"g5-u8" },
                        { label:"æ™‚é–“çš„ä¹˜é™¤", target:"g5-u16" },
                        { label:"æ­£æ–¹é«”å’Œé•·æ–¹é«”", target:"g5-u13" }
                    ],
                    s2: [
                        { label:"åˆ†æ•¸çš„è¨ˆç®—", target:"g5-u12" },
                        { label:"æ•¸çš„åé€²ä½çµæ§‹", target:"g5-u11" },
                        { label:"å°æ•¸çš„ä¹˜æ³•", target:"g5-u14" },
                        { label:"æ‰‡å½¢", target:"g5-u10" },
                        { label:"é«”ç©", target:"g5-u13" },
                        { label:"æ•´æ•¸ã€å°æ•¸é™¤ä»¥æ•´æ•¸", target:"g5-u14" },
                        { label:"ç”Ÿæ´»ä¸­çš„å¤§å–®ä½", target:"g5-u15" },
                        { label:"æ¯”ç‡å’Œç™¾åˆ†ç‡", target:"g5-u18" },
                        { label:"å®¹ç©å’Œå®¹é‡", target:"g5-u17" },
                        { label:"æŸ±é«”ã€éŒé«”å’Œçƒé«”", target:"g5-u5" }
                    ]
                },
                hanLin: null,
                kangXuan: {
                    s1: [
                        { label:"å°æ•¸çš„åŠ æ¸›", target:"g5-u21" },
                        { label:"å› æ•¸èˆ‡å…¬å› æ•¸", target:"g5-u2" },
                        { label:"å€æ•¸èˆ‡å…¬å€æ•¸", target:"g5-u4" },
                        { label:"æ“´åˆ†ã€ç´„åˆ†å’Œé€šåˆ†", target:"g5-u7" },
                        { label:"å¤šé‚Šå½¢èˆ‡æ‰‡å½¢", target:"g5-u10" },
                        { label:"ç•°åˆ†æ¯åˆ†æ•¸çš„åŠ æ¸›", target:"g5-u7" },
                        { label:"ç·šå°ç¨±åœ–å½¢", target:"g5-u20" },
                        { label:"æ•´æ•¸å››å‰‡é‹ç®—", target:"g5-u6" },
                        { label:"é¢ç©", target:"g5-u8" },
                        { label:"æŸ±é«”ã€éŒé«”å’Œçƒ", target:"g5-u5" }
                    ],
                    s2: [
                        { label:"é«”ç©", target:"g5-u13" },
                        { label:"åˆ†æ•¸çš„è¨ˆç®—", target:"g5-u12" },
                        { label:"å®¹ç©", target:"g5-u17" },
                        { label:"å°æ•¸çš„ä¹˜æ³•", target:"g5-u14" },
                        { label:"åé€²ä½çµæ§‹", target:"g5-u11" },
                        { label:"æ•´æ•¸ã€å°æ•¸é™¤ä»¥æ•´æ•¸", target:"g5-u14" },
                        { label:"è¡¨é¢ç©", target:"g5-u19" },
                        { label:"æ¯”ç‡èˆ‡ç™¾åˆ†ç‡", target:"g5-u18" },
                        { label:"æ™‚é–“çš„ä¹˜é™¤", target:"g5-u16" },
                        { label:"ç”Ÿæ´»ä¸­çš„å¤§å–®ä½èˆ‡æŠ˜ç·šåœ–", target:"g5-u15" }
                    ]
                }
            },

            "grade-6": {
                unified: null,
                nanYi: {
                    s1: [
                        { label:"è³ªå› æ•¸åˆ†è§£å’ŒçŸ­é™¤æ³•", target:"g6-u1" },
                        { label:"åˆ†æ•¸çš„é™¤æ³•", target:"g6-u2" },
                        { label:"å°æ•¸çš„é™¤æ³•", target:"g6-u5" },
                        { label:"åœ“å‘¨é•·å’Œåœ“é¢ç©", target:"g6-u7" },
                        { label:"æ¯”å’Œæ¯”å€¼", target:"g6-u4" },
                        { label:"æ‰‡å½¢çš„å¼§é•·å’Œé¢ç©", target:"g6-u11" },
                        { label:"é€Ÿç‡", target:"g6-u12" },
                        { label:"æ•¸é‡é—œä¿‚", target:"g6-u6" }
                    ],
                    s2: [
                        { label:"å››å‰‡æ··åˆé‹ç®—", target:"g6-u10" },
                        { label:"æŸ±é«”çš„é«”ç©å’Œè¡¨é¢ç©", target:"g6-u15" },
                        { label:"åŸºæº–é‡å’Œæ¯”è¼ƒé‡", target:"g6-u6" },
                        { label:"æ”¾å¤§åœ–ã€ç¸®åœ–å’Œæ¯”ä¾‹å°º", target:"g6-u8" },
                        { label:"æ€æ¨£è§£é¡Œ", target:"g6-u9" },
                        { label:"åœ“å½¢åœ–", target:"g6-u13" }
                    ]
                },
                hanLin: {
                    s1: [
                        { label:"æœ€å¤§å…¬å› æ•¸èˆ‡æœ€å°å…¬å€æ•¸", target:"g6-u1" },
                        { label:"åˆ†æ•¸é™¤æ³•", target:"g6-u2" },
                        { label:"è¦å¾‹å•é¡Œ", target:"g6-u3" },
                        { label:"æ¯”èˆ‡æ¯”å€¼", target:"g6-u4" },
                        { label:"å°æ•¸é™¤æ³•", target:"g6-u5" },
                        { label:"å…©é‡é—œä¿‚èˆ‡æ¯”", target:"g6-u6" },
                        { label:"åœ“å‘¨é•·èˆ‡æ‰‡å½¢å‘¨é•·", target:"g6-u7" },
                        { label:"æ”¾å¤§ã€ç¸®å°èˆ‡æ¯”ä¾‹å°º", target:"g6-u8" },
                        { label:"æ€æ¨£è§£é¡Œ", target:"g6-u9" }
                    ],
                    s2: [
                        { label:"åˆ†æ•¸èˆ‡å°æ•¸çš„å››å‰‡é‹ç®—", target:"g6-u10" },
                        { label:"åœ“é¢ç©èˆ‡æ‰‡å½¢é¢ç©", target:"g6-u11" },
                        { label:"é€Ÿç‡", target:"g6-u12" },
                        { label:"çµ±è¨ˆåœ–è¡¨", target:"g6-u13" },
                        { label:"æ€æ¨£è§£é¡Œ", target:"g6-u14" },
                        { label:"è§’æŸ±èˆ‡åœ“æŸ±", target:"g6-u15" }
                    ]
                },
                kangXuan: {
                    s1: [
                        { label:"æœ€å¤§å…¬å› æ•¸èˆ‡æœ€å°å…¬å€æ•¸", target:"g6-u1" },
                        { label:"åˆ†æ•¸é™¤æ³•", target:"g6-u2" },
                        { label:"æ•¸é‡é—œä¿‚", target:"g6-u6" },
                        { label:"å°æ•¸é™¤æ³•", target:"g6-u5" },
                        { label:"æ¯”ã€æ¯”å€¼èˆ‡æˆæ­£æ¯”", target:"g6-u4" },
                        { label:"åœ“å‘¨ç‡èˆ‡åœ“å‘¨é•·", target:"g6-u7" },
                        { label:"åœ“é¢ç©", target:"g6-u11" },
                        { label:"é€Ÿç‡", target:"g6-u12" },
                        { label:"ç¸®åœ–ã€æ”¾å¤§åœ–èˆ‡æ¯”ä¾‹å°º", target:"g6-u8" }
                    ],
                    s2: [
                        { label:"å°æ•¸èˆ‡åˆ†æ•¸çš„è¨ˆç®—", target:"g6-u10" },
                        { label:"é€Ÿç‡çš„æ‡‰ç”¨", target:"g6-u12" },
                        { label:"æŸ±é«”é«”ç©èˆ‡è¡¨é¢ç©", target:"g6-u15" },
                        { label:"åŸºæº–é‡èˆ‡æ¯”è¼ƒé‡", target:"g6-u6" },
                        { label:"æ€æ¨£è§£é¡Œ", target:"g6-u14" },
                        { label:"åœ“å½¢åœ–", target:"g6-u13" }
                    ]
                }
            }
        };

        // --- ç›®å‰é¸åˆ°å“ªå€‹å‡ºç‰ˆç¤¾ï¼ˆæ¯å€‹å¹´ç´šå„è‡ªè¨˜æ†¶ï¼‰ ---
        const selectedPublisherByGrade = {
            "grade-1": "unified",
            "grade-2": "unified",
            "grade-3": "unified",
            "grade-4": "unified",
            "grade-5": "unified",
            "grade-6": "unified"
        };

        function activateGrade(gradeId) {
            const tabs = document.querySelectorAll('.grade-tab-btn');
            tabs.forEach(t => {
                const targetId = t.getAttribute('data-target');
                t.classList.toggle('active', targetId === gradeId);
            });
            document.querySelectorAll('.grade-content').forEach(sec => sec.classList.remove('active-section'));
            const sec = document.getElementById(gradeId);
            if (sec) sec.classList.add('active-section');
        }

        function scrollToCard(cardId, updateHash = true) {
            const card = document.getElementById(cardId);
            if (card) {
                const navHeight = 160;
                const elementPosition = card.getBoundingClientRect().top + window.pageYOffset;
                window.scrollTo({ top: elementPosition - navHeight, behavior: 'smooth' });

                if (updateHash) {
                    if (history && history.replaceState) {
                        history.replaceState(null, '', '#' + cardId);
                    } else {
                        location.hash = cardId;
                    }
                }

                card.classList.add('highlight-card');
                setTimeout(() => { card.classList.remove('highlight-card'); }, 1500);
            }
        }

        // âœ… å·¥å…·ï¼šæŠŠ allGradesData è½‰æˆã€Œçµ±ä¸€ç‰ˆ(ç¾æœ‰)ã€çš„ syllabus çµæ§‹ï¼ˆfallback ç”¨ï¼‰
        function buildUnifiedSyllabusFromAllGrades(gradeId){
            const data = allGradesData[gradeId] || [];
            const s1 = data.filter(u => u.semester === 1).map(u => ({ label: u.title, target: u.id }));
            const s2 = data.filter(u => u.semester === 2).map(u => ({ label: u.title, target: u.id }));
            return { s1, s2 };
        }

        // âœ… å·¥å…·ï¼šæ‹¿åˆ°æŸå¹´ç´šã€æŸå‡ºç‰ˆç¤¾çš„ syllabusï¼ˆæ²’æœ‰å°± fallbackï¼‰
        function getSyllabus(gradeId, publisherKey){
            const g = publisherData[gradeId] || {};
            let pack = g[publisherKey];

            // hanLin å¸¸å¸¸èˆ‡ unified åŒè·¯ç·šï¼šå…è¨±ç”¨ null ä»£è¡¨ fallback
            if (!pack) {
                // å¦‚æœæ­¤å‡ºç‰ˆç¤¾ä¸å­˜åœ¨ï¼Œå°±é€€å›çµ±ä¸€ï¼ˆå†ä¸è¡Œå°±ç”¨ allGradesData åšï¼‰
                pack = g["unified"] || buildUnifiedSyllabusFromAllGrades(gradeId);
            }

            // å¦‚æœ pack æ˜¯ nullï¼Œè¡¨ç¤ºç”¨çµ±ä¸€ fallback
            if (pack === null) pack = g["unified"] || buildUnifiedSyllabusFromAllGrades(gradeId);

            // çµ±ä¸€ä¹Ÿå¯èƒ½æ˜¯ nullï¼ˆgrade-2~6 ä½ ç›®å‰å¡ç‰‡å°±æ˜¯çµ±ä¸€è·¯ç·šï¼‰ï¼Œç›´æ¥ç”¨ allGradesData ç”Ÿæˆ
            if (pack === null) pack = buildUnifiedSyllabusFromAllGrades(gradeId);

            return pack;
        }

        // âœ… å·¥å…·ï¼šæ¸²æŸ“å‡ºç‰ˆç¤¾ tabsï¼ˆä¸¦ä¿ç•™ activeï¼‰
        function renderPublisherTabsHTML(activeKey){
            const items = [
                { key:"unified", label:"çµ±ä¸€ç‰ˆ" },
                { key:"nanYi", label:"å—ä¸€ç‰ˆ" },
                { key:"hanLin", label:"ç¿°æ—ç‰ˆ" },
                { key:"kangXuan", label:"åº·è»’ç‰ˆ" }
            ];
            return items.map(it => `
                <button class="pub-tab ${it.key === activeKey ? 'active' : ''}"
                        data-pub="${it.key}">${it.label}</button>
            `).join('');
        }

        function renderGrade(gradeId, publisher = 'unified') {
            const section = document.getElementById(gradeId);
            const cardContainer = document.getElementById(gradeId.replace('grade-', 'g') + '-container');
            if (!cardContainer) return;

            let syllabusDiv = section.querySelector('.syllabus-container');
            if (!syllabusDiv) {
                syllabusDiv = document.createElement('div');
                syllabusDiv.className = 'syllabus-container';
                section.insertBefore(syllabusDiv, cardContainer);
            }

            // âœ… è¨˜ä½ç›®å‰å‡ºç‰ˆç¤¾ï¼ˆä¸å½±éŸ¿ cardsï¼Œåªå½±éŸ¿ä¸Šæ–¹å°ç…§è¡¨ï¼‰
            selectedPublisherByGrade[gradeId] = publisher;

            const gradeNum = gradeId.split('-')[1];

            // âœ… å–å°ç…§è¡¨è³‡æ–™ï¼ˆå¯é»ä¸‹å»è·³åˆ°ä¸‹æ–¹å¡ç‰‡ï¼‰
            const syllabus = getSyllabus(gradeId, publisher);
            const s1List = syllabus.s1 || [];
            const s2List = syllabus.s2 || [];

            const s1Html = s1List.map((unit, index) =>
                `<div class="unit-tag" onclick="scrollToCard('${unit.target}', true)">
                    <span class="u-num">ä¸»é¡Œ ${index + 1}</span>
                    <i class="fa-solid fa-book"></i> ${unit.label}
                </div>`
            ).join('');

            const s2Html = s2List.map((unit, index) =>
                `<div class="unit-tag" onclick="scrollToCard('${unit.target}', true)">
                    <span class="u-num">ä¸»é¡Œ ${s1List.length + index + 1}</span>
                    <i class="fa-solid fa-book"></i> ${unit.label}
                </div>`
            ).join('');

            // âœ… é€™è£¡æ˜¯ä½ åŸæœ¬ã€Œåªé¡¯ç¤ºçµ±ä¸€ç‰ˆã€çš„åŸå› ï¼šæˆ‘æŠŠ tabs æ”¹æˆå››é¡† + å¯åˆ‡æ›
            syllabusDiv.innerHTML = `
                <div class="syllabus-header">
                    <div class="syllabus-title">
                        <i class="fa-solid fa-book-open" style="color: #0984e3;"></i>
                        <h3>${gradeNum} å¹´ç´šä¸»é¡Œå°ç…§è¡¨</h3>
                    </div>
                    <div class="publisher-tabs" data-grade="${gradeId}">
                        ${renderPublisherTabsHTML(publisher)}
                    </div>
                </div>
                <div class="syllabus-semesters">
                    <div class="semester-block">
                        <h4><i class="fa-solid fa-seedling" style="color:#2ecc71;"></i> ä¸Šå­¸æœŸ</h4>
                        <div class="semester-list">${s1Html}</div>
                    </div>
                    <div class="semester-block">
                        <h4><i class="fa-solid fa-tree" style="color:#27ae60;"></i> ä¸‹å­¸æœŸ</h4>
                        <div class="semester-list">${s2Html}</div>
                    </div>
                </div>
            `;

            // âœ… cardsï¼ˆä¸‹é¢éŠæˆ²å¡ï¼‰å®Œå…¨ç…§èˆŠï¼šä¸å‹•ä½ åŸæœ¬è³‡æ–™çµæ§‹
            const data = allGradesData[gradeId] || [];
            cardContainer.innerHTML = data.map((unit, index) => `
                <div class="game-card" id="${unit.id}">
                    <span class="status-badge open"><i class="fa-solid fa-check"></i> å·²é–‹æ”¾</span>
                    <h3 class="card-title"><i class="fa-solid ${unit.icon}"></i> ä¸»é¡Œ ${index + 1}ï¼š${unit.title}</h3>
                    <p class="keywords"><strong>é‡é»é—œéµå­—</strong><br>${unit.keywords || ''}</p>
                    <div class="card-action">
                        <button class="btn-enter" onclick="openModal('${unit.id}')">é€²å…¥å³¶å¶¼ <i class="fa-solid fa-arrow-right"></i></button>
                    </div>
                </div>
            `).join('');
        }

        const modal = document.getElementById('resourceModal');
        const modalTitle = document.getElementById('modalTitle');
        const btnBasic = document.getElementById('modalBasicBtn');
        const btnAdv = document.getElementById('modalAdvBtn');
        const btnTopicGame = document.getElementById('modalTopicGameBtn');
        const btnVideo = document.getElementById('modalVideoBtn');
        const btnDoc = document.getElementById('modalDocBtn');

        function openModal(unitId) {
            let unitData = null;
            for (const grade in allGradesData) {
                const found = allGradesData[grade].find(u => u.id === unitId);
                if (found) { unitData = found; break; }
            }
            if (!unitData) return;

            if (history && history.replaceState) {
                history.replaceState(null, '', '#' + unitId);
            } else {
                location.hash = unitId;
            }

            modalTitle.innerText = unitData.title;
            const links = unitData.gameLinks || {};
            setupModalButton(btnBasic, links.basic, "åŸºç¤æŒ‘æˆ°");
            setupModalButton(btnAdv, links.advanced, "é€²éšæŒ‘æˆ°");
            setupModalButton(btnTopicGame, links.topicGame, "ä¸»é¡ŒéŠæˆ²"); 
            setupModalButton(btnVideo, links.video, "è§€çœ‹å½±ç‰‡");
            setupModalButton(btnDoc, links.doc, "ä»»å‹™æ–‡æª”");
            modal.classList.add('active');
        }

        function setupModalButton(btn, link, label) {
            const iconPart = btn.innerHTML.split('</i>')[0] + '</i>';
            if (link && link !== "#") { 
                btn.href = link; 
                btn.classList.remove('btn-modal-disabled'); 
                btn.style.pointerEvents = "auto"; 
                btn.innerHTML = iconPart + ' ' + label; 
            } else { 
                btn.href = "#"; 
                btn.classList.add('btn-modal-disabled'); 
                btn.style.pointerEvents = "none"; 
                btn.innerHTML = iconPart + ' ' + label + " (å»ºæ§‹ä¸­)"; 
            }
        }

        function closeModal() { modal.classList.remove('active'); }
        modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

        /* =========================================================
           âœ… åªæ”¹ã€ŒéŒ¨é»å°å¼•ã€ï¼šä¿è­‰æ¯ä¸€å€‹ #g?-u? éƒ½æœƒ
           1) åˆ‡åˆ°å°æ‡‰å¹´ç´š
           2) æ²åˆ°å°æ‡‰ä¸»é¡Œ
           3) è‡ªå‹•é–‹å•Ÿã€Œé€²å…¥å³¶å¶¼ã€å½ˆçª—
           ï¼ˆç­‰å¾… DOM/å¡ç‰‡æ¸²æŸ“å®Œæˆå¾Œæ‰åŸ·è¡Œï¼Œé¿å… Github Pages ç«¶é€Ÿï¼‰
        ========================================================= */

        function normalizeHashToCardId(rawHash){
            const h = (rawHash || '').trim();
            if (!h) return null;
            const cardId = h.startsWith('#') ? h.slice(1) : h;
            const m = cardId.match(/^g([1-6])-u(\d+)$/);
            if (!m) return null;
            return cardId;
        }

        function goToIslandByHash(rawHash){
            const cardId = normalizeHashToCardId(rawHash);
            if (!cardId) return;

            const gradeMatch = cardId.match(/^g([1-6])-u(\d+)$/);
            const gradeId = 'grade-' + gradeMatch[1];

            // âœ… å…ˆåˆ‡å¹´ç´šï¼ˆtab + sectionï¼‰
            activateGrade(gradeId);

            // âœ… é‡è¦ï¼šç­‰å¡ç‰‡çœŸçš„å‡ºç¾ï¼ˆæ¸²æŸ“å®Œæˆï¼‰å†åš scroll + openModal
            const maxFrames = 120; // ç´„ 2 ç§’ï¼ˆ60fpsï¼‰
            let frame = 0;

            const tick = () => {
                frame++;
                const card = document.getElementById(cardId);
                const nav = document.querySelector('.grade-nav-container');

                if (card && nav) {
                    // æ²åˆ°å¹´ç´šå°è¦½é™„è¿‘ï¼ˆè®“è¦–ç·šä¸è¿·è·¯ï¼‰
                    try {
                        window.scrollTo({ top: nav.offsetTop - 85, behavior: 'smooth' });
                    } catch(e){}

                    // å†æ²åˆ°å¡ç‰‡ï¼Œæœ€å¾Œé–‹å½ˆçª—
                    setTimeout(() => {
                        scrollToCard(cardId, false);
                        setTimeout(() => openModal(cardId), 260);
                    }, 220);

                    return; // done
                }

                if (frame < maxFrames) {
                    requestAnimationFrame(tick);
                }
            };

            requestAnimationFrame(tick);
        }

        /* ========================================================= */

        document.addEventListener("DOMContentLoaded", () => {
            // âœ… å…ˆæ¸²æŸ“æ‰€æœ‰å¹´ç´šï¼ˆé è¨­çµ±ä¸€ç‰ˆï¼‰
            ['grade-1','grade-2','grade-3','grade-4','grade-5','grade-6'].forEach(g => renderGrade(g, 'unified'));

            const tabs = document.querySelectorAll('.grade-tab-btn');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetId = tab.getAttribute('data-target');
                    activateGrade(targetId);

                    // âœ… åˆ‡å¹´ç´šæ™‚ï¼šä¿æŒè©²å¹´ç´šç›®å‰é¸æ“‡çš„å‡ºç‰ˆç¤¾ï¼ˆå¦‚æœä½ å‰›åˆ‡åˆ°å—ä¸€ï¼Œå®ƒæœƒè¨˜ä½ï¼‰
                    const pub = selectedPublisherByGrade[targetId] || 'unified';
                    renderGrade(targetId, pub);

                    window.scrollTo({ top: document.querySelector('.grade-nav-container').offsetTop - 85, behavior: 'smooth' });
                });
            });

            // âœ… æ–°å¢ï¼šå‡ºç‰ˆç¤¾ tabs é»æ“Šäº‹ä»¶ï¼ˆäº‹ä»¶å§”æ´¾ï¼Œä¸å½±éŸ¿å…¶ä»–åŠŸèƒ½ï¼‰
            document.body.addEventListener('click', (e) => {
                const btn = e.target.closest('.pub-tab');
                if (!btn) return;

                const wrap = e.target.closest('.publisher-tabs');
                if (!wrap) return;

                const gradeId = wrap.getAttribute('data-grade');
                const pubKey = btn.getAttribute('data-pub');

                if (!gradeId || !pubKey) return;

                // âœ… é‡æ–°æ¸²æŸ“è©²å¹´ç´šçš„ syllabusï¼ˆcards ä¸è®Šï¼‰
                renderGrade(gradeId, pubKey);

                // âœ… è¦–ç·šå›åˆ°å°ç…§è¡¨ä½ç½®ï¼ˆå°å°å„€å¼æ„Ÿï¼‰
                try {
                    const box = document.querySelector('#' + gradeId + ' .syllabus-container');
                    if (box) window.scrollTo({ top: box.offsetTop - 120, behavior: 'smooth' });
                } catch(err){}
            });

            // âœ… åˆæ¬¡è¼‰å…¥ï¼šç›´æ¥ä¾ hash é€²å…¥å³¶å¶¼
            goToIslandByHash(location.hash);
        });

        // âœ… åŒé  hash æ”¹è®Šï¼šä¹Ÿç›´æ¥ä¾ hash é€²å…¥å³¶å¶¼
        window.addEventListener('hashchange', () => {
            goToIslandByHash(location.hash);
        });
    </script>
</body>
</html>
